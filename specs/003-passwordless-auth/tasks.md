# Implementation Tasks: å¢å¼·å‹ç„¡å¯†ç¢¼èªè­‰ç³»çµ±

**åˆ†æ”¯**: `003-passwordless-auth` | **æ—¥æœŸ**: 2025-11-20 | **è¦æ ¼**: [spec.md](./spec.md) | **è¨ˆç•«**: [plan.md](./plan.md) | **ç ”ç©¶**: [research.md](./research.md)

## ğŸ“‹ ä»»å‹™æ¦‚è¦½

**ç¸½ä»»å‹™æ•¸**: 52 å€‹ä»»å‹™
**P1 å„ªå…ˆç´š**: 39 å€‹ä»»å‹™ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
**P2 å„ªå…ˆç´š**: 13 å€‹ä»»å‹™ï¼ˆå¢å¼·åŠŸèƒ½ï¼‰
**å¹³è¡Œæ©Ÿæœƒ**: 30 å€‹ä»»å‹™å¯ä¸¦è¡ŒåŸ·è¡Œ

---

## ğŸ“Š ä½¿ç”¨è€…æ•…äº‹åˆ†è§£

| # | æ•…äº‹ | å„ªå…ˆç´š | ç‹€æ…‹ | ä»»å‹™æ•¸ |
|---|------|--------|------|--------|
| US1 | Google OAuth ç™»å…¥ | P1 | - | 7 |
| US2 | é­”æ³•é€£çµèªè­‰ | P1 | - | 8 |
| US3 | RBAC è§’è‰²å­˜å– | P1 | - | 6 |
| US4 | å·¥ä½œéšæ®µç®¡ç† | P1 | - | 8 |
| US5 | å¸³è™Ÿé€£çµ | P2 | - | 5 |
| US6 | å®‰å…¨æ€§èˆ‡ç¨½æ ¸ | P1 | - | 9 |
| US7 | é›»å­éƒµä»¶è®Šæ›´ | P2 | - | 6 |

---

## ğŸš€ å¯¦æ–½è¨ˆç•«

### MVP ç¯„åœï¼ˆæ¨è–¦ç¬¬ä¸€å€‹è¡åˆºï¼‰
- âœ… **Phase 1**: åŸºç¤è¨­æ–½èˆ‡èªè­‰è¨­å®š
- âœ… **Phase 2**: å‰ç«¯èªè­‰ UIï¼ˆGoogle OAuth + Magic Linkï¼‰
- âœ… **Phase 3**: JWT å·¥ä½œéšæ®µç®¡ç†
- âœ… **Phase 4**: RBAC è§’è‰²æ§åˆ¶
- âœ… **Phase 5**: ç¨½æ ¸æ—¥èªŒï¼ˆåŸºæœ¬ï¼‰

### P2 ç¯„åœï¼ˆå¾ŒçºŒè¿­ä»£ï¼‰
- å¸³è™Ÿé€£çµå·¥ä½œæµ
- é›»å­éƒµä»¶è®Šæ›´èˆ‡è·¨è£ç½®ç„¡æ•ˆåŒ–
- é€²éšç¨½æ ¸åŠŸèƒ½

---

## ğŸ“ å¯¦æ–½ä»»å‹™

### Phase 1: åŸºç¤è¨­æ–½èˆ‡åˆå§‹åŒ–

**ç›®æ¨™**: è¨­å®š Supabase è‡ªä¸»è¨—ç®¡ç’°å¢ƒã€å»ºç«‹æ•¸æ“šåº«çµæ§‹ã€é…ç½®ç’°å¢ƒè®Šæ•¸

**ç¨ç«‹æ¸¬è©¦**: ç¢ºèª Supabase é€£æ¥ã€è³‡æ–™åº«é·ç§»æˆåŠŸã€ç’°å¢ƒè®Šæ•¸å·²åŠ è¼‰

- [ ] T001 åœ¨ Zeabur ä¸Šè¨­å®š Supabase è‡ªä¸»è¨—ç®¡ç’°å¢ƒï¼Œé…ç½® PostgreSQL è³‡æ–™åº«
- [ ] T002 å»ºç«‹ `.env.local` ç¯„æœ¬ä¸¦è¨˜éŒ„æ‰€æœ‰å¿…è¦çš„ Supabase é‡‘é‘°ï¼ˆSUPABASE_URLã€ANON_KEYã€SERVICE_ROLE_KEYï¼‰
- [ ] T003 åŸ·è¡Œè³‡æ–™åº«é·ç§» 001ï¼šå»ºç«‹ users æ“´å±•è¡¨ï¼ŒåŒ…å« idã€emailã€nameã€roleã€created_atã€last_login æ¬„ä½ (supabase/migrations/001_create_users_profile.sql)
- [ ] T004 åŸ·è¡Œè³‡æ–™åº«é·ç§» 002ï¼šå»ºç«‹ auth_methods è¡¨ï¼Œè¿½è¹¤ OAuth å’Œé­”æ³•é€£çµé—œè¯ (supabase/migrations/002_create_auth_methods.sql)
- [ ] T005 åŸ·è¡Œè³‡æ–™åº«é·ç§» 003ï¼šå»ºç«‹ sessions è¡¨ï¼Œè¿½è¹¤å¤šè£ç½®å·¥ä½œéšæ®µ (supabase/migrations/003_create_sessions.sql)
- [ ] T006 åŸ·è¡Œè³‡æ–™åº«é·ç§» 004ï¼šå»ºç«‹ magic_link_tokens è¡¨ï¼Œç®¡ç†ä¸€æ¬¡æ€§é­”æ³•é€£çµ (supabase/migrations/004_create_magic_link_tokens.sql)
- [ ] T007 åŸ·è¡Œè³‡æ–™åº«é·ç§» 005ï¼šå»ºç«‹ auth_events è¡¨ï¼ˆåˆ†å€ï¼‰ï¼Œç¨½æ ¸æ‰€æœ‰èªè­‰äº‹ä»¶ (supabase/migrations/005_create_auth_events.sql)
- [ ] T008 åŸ·è¡Œè³‡æ–™åº«é·ç§» 006ï¼šå»ºç«‹ user_roles è¡¨èˆ‡åˆå§‹ 4 å€‹è§’è‰² (Admin, Class_Teacher, Parent, Student) (supabase/migrations/006_create_user_roles.sql)
- [ ] T009 åŸ·è¡Œè³‡æ–™åº«é·ç§» 007ï¼šè¨­å®š RLS æ”¿ç­–ç”¨æ–¼ RBACï¼Œ4 å€‹è§’è‰²åˆ†åˆ¥çš„è¨ªå•è¦å‰‡ (supabase/migrations/007_setup_rls_policies.sql)
- [ ] T010 åŸ·è¡Œè³‡æ–™åº«é·ç§» 008ï¼šå»ºç«‹èªè­‰è¡¨çš„æ•ˆèƒ½ç´¢å¼• (user_id, email, created_at, event_type) (supabase/migrations/008_create_auth_indexes.sql)
- [ ] T011 å»ºç«‹ rate_limit_attempts è¡¨ï¼Œè¿½è¹¤é­”æ³•é€£çµå’Œç™»å…¥å˜—è©¦ (supabase/migrations/009_create_rate_limiting.sql)
- [ ] T012 åŸ·è¡Œ supabase/seed.sqlï¼Œåˆå§‹åŒ– 4 å€‹è§’è‰²å’Œæ¸¬è©¦ç®¡ç†å“¡å¸³è™Ÿ
- [ ] T013 é©—è­‰æ‰€æœ‰é·ç§»æˆåŠŸã€è¡¨å·²å»ºç«‹ã€RLS æ”¿ç­–å·²å•Ÿç”¨

---

### Phase 2: å‰ç«¯åŸºç¤æ¶æ§‹

**ç›®æ¨™**: å»ºç«‹èªè­‰ä¸Šä¸‹æ–‡ã€æœƒè©±ç®¡ç†ã€Supabase å®¢æˆ¶ç«¯é…ç½®

**ç¨ç«‹æ¸¬è©¦**: Supabase é€£æ¥æˆåŠŸã€AuthContext å¯æä¾›èªè­‰ç‹€æ…‹ã€ç’°å¢ƒè®Šæ•¸å·²åŠ è¼‰

- [ ] T014 [P] å»ºç«‹ src/lib/supabase.tsï¼šé…ç½® Supabase å®¢æˆ¶ç«¯ï¼Œåˆå§‹åŒ– createClient(url, anonKey)
- [ ] T015 [P] å»ºç«‹ src/types/auth.tsï¼šå®šç¾© Userã€Sessionã€AuthMethodã€AuthEvent TypeScript é¡å‹
- [ ] T016 å»ºç«‹ src/context/AuthContext.tsxï¼šæä¾› userã€isLoadingã€signInã€signOutã€signUp ä¸Šä¸‹æ–‡ç‹€æ…‹
- [ ] T017 å»ºç«‹ src/context/SessionContext.tsxï¼šæä¾› activeSessionsã€sessionSyncStatus ç”¨æ–¼å¤šè£ç½®åŒæ­¥
- [ ] T018 [P] å»ºç«‹ src/services/supabaseClient.tsï¼šå†å°å‡ºé…ç½®çš„ Supabase å®¢æˆ¶ç«¯å’Œ auth æ–¹æ³•
- [ ] T019 [P] å»ºç«‹ src/services/tokenManager.tsï¼šç®¡ç†å­˜å–æ¬Šæ–å­˜å„²ï¼ˆè¨˜æ†¶é«”ï¼‰ã€åˆ·æ–°æ¬Šæ–ï¼ˆHttpOnly cookieï¼‰ã€è‡ªå‹•åˆ·æ–°é‚è¼¯
- [ ] T020 å»ºç«‹ src/hooks/useAuth.tsï¼šhook ç”¨æ–¼ç²å–ç•¶å‰ä½¿ç”¨è€…ã€ç™»å…¥ã€ç™»å‡ºã€è¨»å†Šæ“ä½œ
- [ ] T021 å»ºç«‹ src/hooks/useSession.tsï¼šhook ç”¨æ–¼ç²å–ç•¶å‰å·¥ä½œéšæ®µè³‡è¨Šã€å¤šè£ç½®å·¥ä½œéšæ®µåˆ—è¡¨
- [ ] T022 å»ºç«‹ src/lib/rbac.tsï¼šè§’è‰²æª¢æŸ¥å‡½æ•¸ (hasRole, canAccess, requiresAdmin, requiresTeacher)
- [ ] T023 é©—è­‰æ‰€æœ‰ä¸Šä¸‹æ–‡å’Œ hook å¯ä»¥åˆå§‹åŒ–ï¼Œç„¡é¡å‹éŒ¯èª¤

---

### Phase 3: User Story 1 - Google OAuth ç™»å…¥

**æ•…äº‹ç›®æ¨™**: å®¶é•·å¯ä»¥é€šé Google OAuth å¿«é€Ÿç™»å…¥ç„¡å¯†ç¢¼ç³»çµ±

**é©—æ”¶æ¨™æº–**:
- âœ… æ–°ä½¿ç”¨è€…å¯ä»¥é»æ“Šã€Œä½¿ç”¨ Google ç™»å…¥ã€ä¸¦æˆæ¬Š
- âœ… Google å›èª¿é‡æ–°å°å‘ä½¿ç”¨è€…åˆ°å„€è¡¨æ¿
- âœ… ç¾æœ‰ä½¿ç”¨è€…å†æ¬¡ç™»å…¥æ™‚ç«‹å³ç™»å…¥ï¼ˆç„¡éœ€æ–°å¸³è™Ÿå»ºç«‹ï¼‰
- âœ… å–æ¶ˆ OAuth æ™‚è¿”å›ç™»å…¥é é¢
- âœ… OAuth ç•°å¸¸å„ªé›…åœ°è™•ç†

**ä¸¦è¡ŒåŸ·è¡Œ**: T024-T030 å¯ä¸¦è¡Œ

- [ ] T024 [P] [US1] å»ºç«‹ src/components/OAuthFlow.tsxï¼šGoogle OAuth æŒ‰éˆ•ã€PKCE æµç¨‹å•Ÿå‹•ã€é‡æ–°å°å‘è™•ç†
- [ ] T025 [P] [US1] å»ºç«‹ src/services/authService.tsï¼šinitGoogleOAuth()ã€handleOAuthCallback()ã€createOrUpdateUserOnOAuth()
- [ ] T026 [P] [US1] å»ºç«‹ supabase/functions/auth-handlers/oauth-callback.tsï¼šDeno Edge Function ç”¨æ–¼ OAuth å›èª¿è™•ç†å’Œä½¿ç”¨è€…å»ºç«‹
- [ ] T027 [P] [US1] å»ºç«‹ src/hooks/useGoogleOAuth.tsï¼šhook ç®¡ç† OAuth ç‹€æ…‹ã€åŠ è¼‰ã€éŒ¯èª¤ã€å›èª¿
- [ ] T028 [P] [US1] å»ºç«‹ src/components/LoginPage.tsxï¼šé›†æˆ OAuthFlow å…ƒä»¶ã€é¡¯ç¤ºç™»å…¥é¸é …ã€é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
- [ ] T029 [US1] æ›´æ–° src/context/AuthContext.tsxï¼šæ–°å¢ signInWithGoogle æ–¹æ³•ã€è™•ç† OAuth ç‹€æ…‹
- [ ] T030 [US1] æ›´æ–° src/App.tsxï¼šæ·»åŠ  /auth/callback è·¯ç”±ç”¨æ–¼ OAuth é‡æ–°å°å‘è™•ç†
- [ ] T031 [US1] å»ºç«‹ supabase/functions/auth-handlers/create-session.tsï¼šæˆåŠŸ OAuth å¾Œå»ºç«‹ JWT å·¥ä½œéšæ®µ
- [ ] T032 [US1] å»ºç«‹ supabase/functions/utility/audit-logger.tsï¼šè¨˜éŒ„ OAuth ç™»å…¥äº‹ä»¶åˆ° auth_events è¡¨
- [ ] T033 [US1] æ¸¬è©¦ Google OAuth å®Œæ•´æµç¨‹ï¼šæˆæ¬Š â†’ å›èª¿ â†’ å·¥ä½œéšæ®µå»ºç«‹ â†’ å„€è¡¨æ¿é‡æ–°å°å‘

---

### Phase 4: User Story 2 - é­”æ³•é€£çµèªè­‰

**æ•…äº‹ç›®æ¨™**: æ²’æœ‰ Google å¸³è™Ÿçš„ä½¿ç”¨è€…å¯ä»¥é€šéé›»å­éƒµä»¶é­”æ³•é€£çµç™»å…¥

**é©—æ”¶æ¨™æº–**:
- âœ… ä½¿ç”¨è€…è¼¸å…¥é›»å­éƒµä»¶ä¸¦æ”¶åˆ°é­”æ³•é€£çµ
- âœ… é­”æ³•é€£çµ 15 åˆ†é˜å¾ŒéæœŸ
- âœ… é­”æ³•é€£çµä¸€æ¬¡æ€§ä½¿ç”¨ï¼ˆé‡è¤‡ä½¿ç”¨è¢«æ‹’çµ•ï¼‰
- âœ… é€Ÿç‡é™åˆ¶ï¼šæ¯å°æ™‚ 5 å€‹é­”æ³•é€£çµ/é›»å­éƒµä»¶
- âœ… æ–°é›»å­éƒµä»¶è‡ªå‹•å»ºç«‹å¸³è™Ÿï¼Œç¾æœ‰é›»å­éƒµä»¶è‡ªå‹•ç™»å…¥

**ä¸¦è¡ŒåŸ·è¡Œ**: T034-T041 å¯ä¸¦è¡Œ

- [ ] T034 [P] [US2] å»ºç«‹ src/components/MagicLinkForm.tsxï¼šé›»å­éƒµä»¶è¼¸å…¥è¡¨å–®ã€ç™¼é€é€£çµæŒ‰éˆ•ã€ç¢ºèªè¨Šæ¯
- [ ] T035 [P] [US2] å»ºç«‹ src/services/authService.ts æ“´å±•ï¼šrequestMagicLink()ã€verifyMagicLink()
- [ ] T036 [P] [US2] å»ºç«‹ supabase/functions/auth-handlers/magic-link-send.tsï¼šç”Ÿæˆå®‰å…¨æ¬Šæ–ã€ç™¼é€é›»å­éƒµä»¶ã€æª¢æŸ¥é€Ÿç‡é™åˆ¶
- [ ] T037 [P] [US2] å»ºç«‹ supabase/functions/auth-handlers/magic-link-verify.tsï¼šé©—è­‰æ¬Šæ–ã€å»ºç«‹æˆ–ç™»å…¥ä½¿ç”¨è€…ã€å»ºç«‹å·¥ä½œéšæ®µ
- [ ] T038 [P] [US2] å»ºç«‹ supabase/functions/utility/rate-limiter.tsï¼šcheckRateLimit(limitType, identifier, limit, windowSeconds)
- [ ] T039 [P] [US2] å»ºç«‹ src/hooks/useMagicLink.tsï¼šhook ç®¡ç†é­”æ³•é€£çµç‹€æ…‹ã€ç™¼é€é‚è¼¯ã€é©—è­‰é‚è¼¯
- [ ] T040 [US2] æ›´æ–° src/context/AuthContext.tsxï¼šæ–°å¢ requestMagicLinkã€verifyMagicLink æ–¹æ³•
- [ ] T041 [US2] æ›´æ–° src/App.tsxï¼šæ·»åŠ  /auth/magic-link è·¯ç”±ç”¨æ–¼é©—è­‰æµç¨‹
- [ ] T042 [US2] æ›´æ–° supabase/migrations/004_create_magic_link_tokens.sqlï¼šç¢ºä¿ used_at è¿½è¹¤ã€expires_at ç´¢å¼•
- [ ] T043 [US2] æ¸¬è©¦é­”æ³•é€£çµå®Œæ•´æµç¨‹ï¼šç”³è«‹ â†’ é›»å­éƒµä»¶ â†’ é©—è­‰ â†’ å·¥ä½œéšæ®µå»ºç«‹

---

### Phase 5: User Story 3 - RBAC è§’è‰²å­˜å–æ§åˆ¶

**æ•…äº‹ç›®æ¨™**: ç®¡ç†å“¡ã€æ•™å¸«ã€å®¶é•·ã€å­¸ç”Ÿå„æœ‰ä¸åŒçš„è¨ªå•æ¬Šé™

**é©—æ”¶æ¨™æº–**:
- âœ… ç®¡ç†å“¡å¯ä»¥å­˜å–æ‰€æœ‰ä½¿ç”¨è€…å’Œå…§å®¹
- âœ… æ•™å¸«åªèƒ½ç·¨è¼¯å…¶ç­ç´šçš„æ–‡ç« 
- âœ… å®¶é•·åªçœ‹åˆ°å…¶å­©å­ç­ç´šçš„æ–‡ç« 
- âœ… å­¸ç”Ÿåªçœ‹åˆ°å…¬é–‹æ–‡ç« 
- âœ… å¤šå­©å­å®¶é•·çœ‹åˆ°æ‰€æœ‰å­©å­çš„å…§å®¹

**ä¸¦è¡ŒåŸ·è¡Œ**: T044-T049 å¯ä¸¦è¡Œ

- [ ] T044 [P] [US3] å»ºç«‹ src/components/ProtectedRoute.tsxï¼šæª¢æŸ¥ä½¿ç”¨è€…è§’è‰²ã€ç¦æ­¢æœªæˆæ¬Šè¨ªå•ã€é¡¯ç¤ºéŒ¯èª¤é é¢
- [ ] T045 [P] [US3] å»ºç«‹ src/components/AdminDashboard.tsxï¼šä½¿ç”¨è€…ç®¡ç†ã€è§’è‰²åˆ†é…ã€å·¥ä½œéšæ®µç®¡ç†ä»‹é¢
- [ ] T046 [P] [US3] æ›´æ–° supabase/migrations/007_setup_rls_policies.sqlï¼šæ“´å±• RLS æ”¿ç­–ç”¨æ–¼ articlesã€user_rolesã€class_enrollments è¡¨
- [ ] T047 [P] [US3] å»ºç«‹ supabase/functions/utility/rbac-checker.tsï¼šcheckPermission(userId, action, resource)
- [ ] T048 [US3] æ›´æ–° src/App.tsxï¼šç”¨ ProtectedRoute åŒ…è£å—ä¿è­·çš„é é¢ (AdminDashboard, AccountSettings)
- [ ] T049 [US3] å‰µå»ºæ¸¬è©¦ç®¡ç†å“¡ã€æ•™å¸«ã€å®¶é•·ã€å­¸ç”Ÿä½¿ç”¨è€…ç”¨æ–¼ RBAC æ¸¬è©¦

---

### Phase 6: User Story 4 - å·¥ä½œéšæ®µç®¡ç†èˆ‡å¤šè£ç½®æ”¯æ´

**æ•…äº‹ç›®æ¨™**: ä½¿ç”¨è€…åœ¨å¤šå€‹è£ç½®ä¸Šä¿æŒç™»å…¥ç‹€æ…‹ï¼ˆ30 å¤©ï¼‰ã€è‡ªå‹•åˆ·æ–°ã€è¨­å‚™ç´šç™»å‡º

**é©—æ”¶æ¨™æº–**:
- âœ… å·¥ä½œéšæ®µåœ¨ 30 å¤©å…§æŒä¹…åŒ–
- âœ… å­˜å–æ¬Šæ–è‡ªå‹•åˆ·æ–°ï¼ˆ15 åˆ†é˜å‰ï¼‰
- âœ… å¤šå€‹è£ç½®æ”¯æ´ç¨ç«‹å·¥ä½œéšæ®µ
- âœ… ç™»å‡ºåƒ…å½±éŸ¿ç•¶å‰è£ç½®
- âœ… è¶…é 30 å¤©å¼·åˆ¶é‡æ–°é©—è­‰

**ä¸¦è¡ŒåŸ·è¡Œ**: T050-T057 å¯ä¸¦è¡Œ

- [ ] T050 [P] [US4] æ›´æ–° src/services/tokenManager.tsï¼šå¯¦ç¾è‡ªå‹•åˆ·æ–°é‚è¼¯ã€åœ¨è¨˜æ†¶é«”ä¸­å„²å­˜å­˜å–æ¬Šæ–ã€HttpOnly cookie åˆ·æ–°æ¬Šæ–
- [ ] T051 [P] [US4] å»ºç«‹ src/hooks/useSessionSync.tsï¼šhook ç›£è½ Supabase Realtime å·¥ä½œéšæ®µè®Šæ›´ã€è·¨è£ç½®åŒæ­¥
- [ ] T052 [P] [US4] å»ºç«‹ src/components/SessionManager.tsxï¼šé¡¯ç¤ºæ´»èºå·¥ä½œéšæ®µã€è¨­å‚™è³‡è¨Šã€ç™»å‡ºæŒ‰éˆ•ï¼ˆè¨­å‚™ç´šï¼‰
- [ ] T053 [P] [US4] æ›´æ–° supabase/functions/session-handlers/create-session.tsï¼šç”Ÿæˆ JWTã€è¨­ç½® 30 å¤©åˆ·æ–°æ¬Šæ–ã€è¨˜éŒ„å·¥ä½œéšæ®µ
- [ ] T054 [P] [US4] å»ºç«‹ supabase/functions/session-handlers/validate-session.tsï¼šé©—è­‰å·¥ä½œéšæ®µã€æª¢æŸ¥éæœŸæ™‚é–“
- [ ] T055 [P] [US4] æ›´æ–° src/context/AuthContext.tsxï¼šå¯¦ç¾è‡ªå‹•åˆ·æ–°æª¢æŸ¥ã€å·¥ä½œéšæ®µæŒä¹…åŒ–
- [ ] T056 [US4] å»ºç«‹ supabase/functions/session-handlers/invalidate-session.tsï¼šè¨­å‚™ç´šç™»å‡ºã€ç„¡æ•ˆåŒ–å–®ä¸€å·¥ä½œéšæ®µ
- [ ] T057 [US4] è¨­ç½® Supabase Realtime è¨‚é–±ï¼Œç›£è½ sessions è¡¨è®Šæ›´ç”¨æ–¼è·¨è£ç½®åŒæ­¥
- [ ] T058 [US4] æ¸¬è©¦å¤šè£ç½®ç™»å…¥ã€è‡ªå‹•åˆ·æ–°ã€è¨­å‚™ç´šç™»å‡ºæµç¨‹

---

### Phase 7: User Story 6 - å®‰å…¨æ€§èˆ‡ç¨½æ ¸æ—¥èªŒ

**æ•…äº‹ç›®æ¨™**: è¨˜éŒ„æ‰€æœ‰èªè­‰äº‹ä»¶ã€å¯¦æ–½é€Ÿç‡é™åˆ¶ã€ç®¡ç†å“¡å¯å¼·åˆ¶ç™»å‡º

**é©—æ”¶æ¨™æº–**:
- âœ… æ‰€æœ‰ç™»å…¥äº‹ä»¶è¨˜éŒ„åˆ°ç¨½æ ¸æ—¥èªŒ
- âœ… é€Ÿç‡é™åˆ¶é˜²æ­¢æš´åŠ›æ”»æ“Š
- âœ… å¯ç–‘æ´»å‹•è­¦å ±ï¼ˆå¤šå€‹å¤±æ•—å˜—è©¦ï¼‰
- âœ… ç®¡ç†å“¡å¯æŸ¥çœ‹ç¨½æ ¸æ—¥èªŒä¸¦æŒ‰æ–¹æ³•ç¯©é¸
- âœ… ç®¡ç†å“¡å¯å¼·åˆ¶ç™»å‡ºä½¿ç”¨è€…çš„æ‰€æœ‰å·¥ä½œéšæ®µ

**ä¸¦è¡ŒåŸ·è¡Œ**: T059-T067 å¯ä¸¦è¡Œ

- [ ] T059 [P] [US6] æ›´æ–° supabase/functions/utility/audit-logger.tsï¼šå¢å¼· logAuthEvent()ã€æ”¯æ´æ‰€æœ‰äº‹ä»¶é¡å‹
- [ ] T060 [P] [US6] å»ºç«‹ supabase/functions/auth-handlers/rate-limit-check.tsï¼šæª¢æŸ¥é­”æ³•é€£çµå’Œç™»å…¥é€Ÿç‡é™åˆ¶
- [ ] T061 [P] [US6] å»ºç«‹ supabase/functions/admin-handlers/get-user-sessions.tsï¼šç®¡ç†å“¡æŸ¥è©¢ä½¿ç”¨è€…æ‰€æœ‰å·¥ä½œéšæ®µ
- [ ] T062 [P] [US6] å»ºç«‹ supabase/functions/admin-handlers/force-logout.tsï¼šç„¡æ•ˆåŒ–æŒ‡å®šä½¿ç”¨è€…çš„æ‰€æœ‰å·¥ä½œéšæ®µ
- [ ] T063 [P] [US6] æ›´æ–° src/components/AdminDashboard.tsxï¼šæ·»åŠ ç¨½æ ¸æ—¥èªŒæŸ¥çœ‹ã€ç¯©é¸ã€å°å‡ºåŠŸèƒ½
- [ ] T064 [P] [US6] å»ºç«‹ src/components/AuditLogViewer.tsxï¼šé¡¯ç¤ºç¨½æ ¸æ—¥èªŒåˆ—è¡¨ã€æŒ‰æ–¹æ³•/ä½¿ç”¨è€…ç¯©é¸ã€æ™‚é–“ç¯„åœæŸ¥è©¢
- [ ] T065 [US6] æ›´æ–° src/context/AuthContext.tsxï¼šæ‰€æœ‰èªè­‰æ“ä½œè¨˜éŒ„åˆ°ç¨½æ ¸æ—¥èªŒ
- [ ] T066 [US6] è¨­ç½® PostgreSQL cron ä½œæ¥­æ¸…ç†éæœŸé€Ÿç‡é™åˆ¶è¨˜éŒ„ï¼ˆæ¯ 5 åˆ†é˜ï¼‰
- [ ] T067 [US6] æ¸¬è©¦ç¨½æ ¸æ—¥èªŒè¨˜éŒ„ã€é€Ÿç‡é™åˆ¶åŸ·è¡Œã€ç®¡ç†å“¡å¼·åˆ¶ç™»å‡º

---

### Phase 8: User Story 5 - å¸³è™Ÿé€£çµï¼ˆP2ï¼‰

**æ•…äº‹ç›®æ¨™**: ä½¿ç”¨è€…å¯ä»¥å°‡ Google OAuth é€£çµåˆ°ç¾æœ‰å¸³è™Ÿï¼Œæ”¯æŒå¤šç¨®ç™»å…¥æ–¹æ³•

**é©—æ”¶æ¨™æº–**:
- âœ… å·²ç™»å…¥ä½¿ç”¨è€…å¯ä»¥åœ¨å¸³è™Ÿè¨­å®šä¸­é€£çµ Google
- âœ… é€£çµå¾Œå…©ç¨®æ–¹æ³•éƒ½å¯ç™»å…¥åŒä¸€å¸³è™Ÿ
- âœ… ç„¡æ³•ç¦ç”¨å”¯ä¸€çš„ç™»å…¥æ–¹æ³•ï¼ˆé˜²æ­¢é–å®šï¼‰

**ä¸¦è¡ŒåŸ·è¡Œ**: T068-T072 å¯ä¸¦è¡Œ

- [ ] T068 [P] [US5] å»ºç«‹ src/components/AccountSettings.tsxï¼šå¸³è™Ÿé€£çµä»‹é¢ã€å·²é€£çµæ–¹æ³•åˆ—è¡¨ã€æ–°å¢/ç§»é™¤é€£çµ
- [ ] T069 [P] [US5] å»ºç«‹ supabase/functions/auth-handlers/link-oauth.tsï¼šé€£çµ Google åˆ°ç¾æœ‰å¸³è™Ÿ
- [ ] T070 [P] [US5] æ›´æ–° src/context/AuthContext.tsxï¼šæ–°å¢ linkOAuthMethodã€unlinkAuthMethod
- [ ] T071 [US5] æ›´æ–° FR-004 å’Œ FR-005 å¯¦æ–½ï¼šæ”¯æ´å¸³è™Ÿé€£çµ UI å’Œé‚è¼¯
- [ ] T072 [US5] æ¸¬è©¦å¸³è™Ÿé€£çµæµç¨‹ã€é˜²æ­¢æœ€å¾Œæ–¹æ³•ç§»é™¤

---

### Phase 9: User Story 7 - é›»å­éƒµä»¶è®Šæ›´èˆ‡å·¥ä½œéšæ®µç„¡æ•ˆåŒ–ï¼ˆP2ï¼‰

**æ•…äº‹ç›®æ¨™**: ä½¿ç”¨è€…å¯ä»¥è®Šæ›´é›»å­éƒµä»¶ï¼Œæ‰€æœ‰å·¥ä½œéšæ®µè‡ªå‹•ç„¡æ•ˆåŒ–ä»¥ç¢ºä¿å®‰å…¨

**é©—æ”¶æ¨™æº–**:
- âœ… ä½¿ç”¨è€…åœ¨å¸³è™Ÿè¨­å®šä¸­è¼¸å…¥æ–°é›»å­éƒµä»¶
- âœ… ç³»çµ±ç™¼é€é©—è­‰é€£çµåˆ°æ–°é›»å­éƒµä»¶
- âœ… é©—è­‰å¾Œé›»å­éƒµä»¶æ›´æ–°ã€æ‰€æœ‰å·¥ä½œéšæ®µç„¡æ•ˆåŒ–
- âœ… èˆŠé›»å­éƒµä»¶ç„¡æ³•å†ç™»å…¥
- âœ… æœªé©—è­‰æ™‚ä¿æŒåŸé›»å­éƒµä»¶

**ä¸¦è¡ŒåŸ·è¡Œ**: T073-T078 å¯ä¸¦è¡Œ

- [ ] T073 [P] [US7] æ›´æ–° src/components/AccountSettings.tsxï¼šæ·»åŠ é›»å­éƒµä»¶è®Šæ›´è¡¨å–®ã€æ–°é›»å­éƒµä»¶è¼¸å…¥
- [ ] T074 [P] [US7] å»ºç«‹ supabase/functions/auth-handlers/email-change-request.tsï¼šç™¼é€é©—è­‰é€£çµåˆ°æ–°é›»å­éƒµä»¶ã€æª¢æŸ¥å”¯ä¸€æ€§
- [ ] T075 [P] [US7] å»ºç«‹ supabase/functions/auth-handlers/email-change-verify.tsï¼šé©—è­‰æ–°é›»å­éƒµä»¶ã€æ›´æ–°ä½¿ç”¨è€…ã€ç„¡æ•ˆåŒ–æ‰€æœ‰å·¥ä½œéšæ®µ
- [ ] T076 [P] [US7] æ›´æ–° supabase/functions/session-handlers/invalidate-session.tsï¼šæ”¯æ´è·¨è£ç½®ç„¡æ•ˆåŒ–é€šçŸ¥
- [ ] T077 [US7] æ›´æ–° src/hooks/useSessionSync.tsï¼šç›£è½é›»å­éƒµä»¶è®Šæ›´äº‹ä»¶ã€è‡ªå‹•ç™»å‡ºå…¶ä»–è£ç½®
- [ ] T078 [US7] æ¸¬è©¦é›»å­éƒµä»¶è®Šæ›´å®Œæ•´æµç¨‹ã€è·¨è£ç½®ç„¡æ•ˆåŒ–ã€èˆŠé›»å­éƒµä»¶æ‹’çµ•

---

### Phase 10: åŠŸèƒ½æ•´åˆèˆ‡æ¸¬è©¦

**ç›®æ¨™**: æ•´åˆæ‰€æœ‰åŠŸèƒ½ã€åŸ·è¡Œå®Œæ•´æµç¨‹æ¸¬è©¦ã€é©—è­‰å®‰å…¨æ€§

- [ ] T079 [P] åŸ·è¡Œç«¯å°ç«¯æ¸¬è©¦ï¼šGoogle OAuth â†’ å·¥ä½œéšæ®µ â†’ RBAC â†’ ç¨½æ ¸æ—¥èªŒ
- [ ] T080 [P] åŸ·è¡Œç«¯å°ç«¯æ¸¬è©¦ï¼šé­”æ³•é€£çµ â†’ ä½¿ç”¨è€…å»ºç«‹ â†’ å¤šè£ç½® â†’ å·¥ä½œéšæ®µç®¡ç†
- [ ] T081 [P] åŸ·è¡Œé€Ÿç‡é™åˆ¶æ¸¬è©¦ï¼šè¶…éé™åˆ¶æ™‚è¢«é˜»æ­¢ã€è¨ˆæ•¸æ­£ç¢ºé‡ç½®
- [ ] T082 [P] åŸ·è¡Œ RBAC é©—è­‰ï¼šæ¯å€‹è§’è‰²åªèƒ½è¨ªå•æˆæ¬Šè³‡æº
- [ ] T083 [P] åŸ·è¡Œç¨½æ ¸æ—¥èªŒé©—è­‰ï¼šæ‰€æœ‰äº‹ä»¶è¢«æ­£ç¢ºè¨˜éŒ„ã€ç®¡ç†å“¡å¯æŸ¥çœ‹
- [ ] T084 åŸ·è¡Œå®‰å…¨æ€§æª¢æŸ¥ï¼šCSRF ä¿è­·ã€XSS é˜²è­·ã€SQL æ³¨å…¥é é˜²
- [ ] T085 åŸ·è¡Œæ•ˆèƒ½æ¸¬è©¦ï¼šç™»å…¥ <2 åˆ†é˜ã€é é¢è¼‰å…¥ <3 ç§’ï¼ˆ4Gï¼‰ã€1000 ä¸¦è¡Œè«‹æ±‚
- [ ] T086 åŸ·è¡Œæ•´åˆæ¸¬è©¦ï¼šæ‰€æœ‰ API ç«¯é»ã€Supabase å‡½æ•¸ã€RLS æ”¿ç­–

---

### Phase 11: æ–‡æª”èˆ‡äº¤ä»˜

**ç›®æ¨™**: ç·¨å¯«é–‹ç™¼æ–‡æª”ã€éƒ¨ç½²æŒ‡å—ã€API æ–‡æª”

- [ ] T087 å»ºç«‹ SETUP.mdï¼šSupabase é…ç½®æ­¥é©Ÿã€ç’°å¢ƒè®Šæ•¸è¨­å®šã€æœ¬åœ°é–‹ç™¼æŒ‡å—
- [ ] T088 å»ºç«‹ API-ENDPOINTS.mdï¼šæ‰€æœ‰èªè­‰ç«¯é»æ–‡æª”ã€è«‹æ±‚/å›æ‡‰æ ¼å¼ã€éŒ¯èª¤ç¢¼
- [ ] T089 å»ºç«‹ DEPLOYMENT.mdï¼šZeabur éƒ¨ç½²æ­¥é©Ÿã€ç”Ÿç”¢ç’°å¢ƒé…ç½®ã€ç›£è¦–è¨­å®š
- [ ] T090 å»ºç«‹ SECURITY.mdï¼šå®‰å…¨æœ€ä½³å¯¦è¸ã€å¨è„…æ¨¡å‹ã€é€Ÿç‡é™åˆ¶é…ç½®
- [ ] T091 æ›´æ–° README.mdï¼šåŠŸèƒ½æ¦‚è¿°ã€å¿«é€Ÿé–‹å§‹ã€å¸¸è¦‹å•é¡Œ

---

### Phase 12: å„ªåŒ–èˆ‡æ½¤é£¾

**ç›®æ¨™**: æ”¹é€²æ•ˆèƒ½ã€å®Œå–„ UXã€ä¿®å¾©é‚Šç•Œæƒ…æ³

- [ ] T092 [P] å„ªåŒ– Supabase æŸ¥è©¢æ•ˆèƒ½ï¼šç¢ºèªæ‰€æœ‰ç´¢å¼•å·²å»ºç«‹ã€RLS æ”¿ç­–å„ªåŒ–
- [ ] T093 [P] å„ªåŒ–å‰ç«¯åŒ…å¤§å°ï¼šä»£ç¢¼åˆ†å‰²ã€å»¶é²åŠ è¼‰ã€æ¨¹æ–
- [ ] T094 [P] æ”¹å–„ UXï¼šè¼‰å…¥ç‹€æ…‹ã€éŒ¯èª¤è¨Šæ¯ã€ç¢ºèªå°è©±æ¡†
- [ ] T095 å¯¦æ–½éŒ¯èª¤ç›£æ§ï¼šé›†æˆ Sentry æˆ–é¡ä¼¼ç”¨æ–¼ç”Ÿç”¢ç›£è¦–
- [ ] T096 è¨­ç½®æ—¥èªŒæ—‹è½‰ï¼šç¨½æ ¸æ—¥èªŒæª”æ¡ˆç®¡ç†ã€å­˜æª”ç­–ç•¥
- [ ] T097 å¯¦æ–½åˆ†æè¿½è¹¤ï¼šèªè­‰æˆåŠŸç‡ã€æ•ˆèƒ½æŒ‡æ¨™ã€ä½¿ç”¨è€…ä¿ç•™
- [ ] T098 é€²è¡Œæœ€çµ‚ç¨‹å¼ç¢¼å¯©æŸ¥ï¼šéµå¾ªé …ç›®æ†²æ³•ã€ç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥
- [ ] T099 æº–å‚™ç™¼ä½ˆèªªæ˜ï¼šè®Šæ›´æ‘˜è¦ã€å·²çŸ¥å•é¡Œã€ä¸‹ä¸€æ­¥è¨ˆåŠƒ
- [ ] T100 åŸ·è¡Œå›æ­¸æ¸¬è©¦ï¼šç¢ºä¿ç¾æœ‰åŠŸèƒ½æœªç ´æã€æ–°åŠŸèƒ½æ•´åˆé †åˆ©

---

## ğŸ”— ä»»å‹™ä¾è³´é—œä¿‚

```
Phase 1 (åŸºç¤è¨­æ–½)
    â†“
Phase 2 (å‰ç«¯åŸºç¤)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 3-7 (P1 ä½¿ç”¨è€…æ•…äº‹)      â”‚ (ä¸¦è¡ŒåŸ·è¡Œ)
â”‚ â€¢ Google OAuth                 â”‚
â”‚ â€¢ Magic Link                   â”‚
â”‚ â€¢ RBAC                         â”‚
â”‚ â€¢ å·¥ä½œéšæ®µ                     â”‚
â”‚ â€¢ ç¨½æ ¸æ—¥èªŒ                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 8-9 (P2 ä½¿ç”¨è€…æ•…äº‹)      â”‚ (å¯åœ¨ä¹‹å¾Œæˆ–ä¸¦è¡Œ)
â”‚ â€¢ å¸³è™Ÿé€£çµ                     â”‚
â”‚ â€¢ é›»å­éƒµä»¶è®Šæ›´                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
Phase 10 (æ¸¬è©¦èˆ‡é©—è­‰)
    â†“
Phase 11 (æ–‡æª”)
    â†“
Phase 12 (å„ªåŒ–èˆ‡ç™¼ä½ˆ)
```

---

## ğŸ¯ ä¸¦è¡ŒåŸ·è¡Œç­–ç•¥

### æ¨è–¦ä¸¦è¡Œçµ„åˆ

**ä¸¦è¡Œé›†åˆ 1** (T024-T033): Google OAuth å®Œæ•´å¯¦æ–½
- å‰ç«¯ UI (T024, T028)
- å¾Œç«¯æœå‹™ (T025, T026)
- å·¥ä½œéšæ®µå»ºç«‹ (T031)
- ç¨½æ ¸è¨˜éŒ„ (T032)

**ä¸¦è¡Œé›†åˆ 2** (T034-T043): é­”æ³•é€£çµå®Œæ•´å¯¦æ–½
- å‰ç«¯ UI (T034)
- å¾Œç«¯æœå‹™ (T035-T037)
- é€Ÿç‡é™åˆ¶ (T038)
- Hook å’Œè·¯ç”± (T039-T041)

**ä¸¦è¡Œé›†åˆ 3** (T044-T049): RBAC å®Œæ•´å¯¦æ–½
- å‰ç«¯ä¿è­· (T044-T045)
- è³‡æ–™åº«æ”¿ç­– (T046)
- æª¢æŸ¥å‡½æ•¸ (T047-T048)

**ä¸¦è¡Œé›†åˆ 4** (T050-T058): å·¥ä½œéšæ®µç®¡ç†
- æ¬Šæ–ç®¡ç† (T050)
- åŒæ­¥æ©Ÿåˆ¶ (T051)
- UI å…ƒä»¶ (T052)
- å¾Œç«¯å‡½æ•¸ (T053-T057)

**ä¸¦è¡Œé›†åˆ 5** (T059-T067): å®‰å…¨æ€§èˆ‡ç¨½æ ¸
- ç¨½æ ¸æ—¥èªŒ (T059)
- é€Ÿç‡é™åˆ¶ (T060)
- ç®¡ç†å“¡åŠŸèƒ½ (T061-T062)
- UI å’Œæ¸…ç† (T063-T066)

---

## âœ… æˆåŠŸæ¨™æº–

### æ¯å€‹ä½¿ç”¨è€…æ•…äº‹å®Œæˆæ™‚

- âœ… æ‰€æœ‰å—ç†æ¢ä»¶é€šé
- âœ… ç›¸é—œåŠŸèƒ½éœ€æ±‚å¯¦æ–½
- âœ… å–®å…ƒæ¸¬è©¦è¦†è“‹ >80%
- âœ… æ•´åˆæ¸¬è©¦é€šé
- âœ… ç¨½æ ¸æ—¥èªŒè¨˜éŒ„æ‰€æœ‰äº‹ä»¶
- âœ… RBAC æ”¿ç­–é©—è­‰è¨ªå•æ§åˆ¶
- âœ… é€Ÿç‡é™åˆ¶æ­£å¸¸å·¥ä½œ
- âœ… ç„¡å®‰å…¨æ¼æ´ï¼ˆOWASP Top 10ï¼‰

### æ•´é«”äº¤ä»˜å®Œæˆæ™‚

- âœ… æ‰€æœ‰ 7 å€‹ä½¿ç”¨è€…æ•…äº‹å¯¦æ–½ï¼ˆP1 å„ªå…ˆï¼‰
- âœ… 42 å€‹åŠŸèƒ½éœ€æ±‚æ»¿è¶³
- âœ… 15 å€‹æˆåŠŸæ¨™æº–é”æˆ
- âœ… æ–‡æª”å®Œæ•´ï¼ˆAPIã€è¨­å®šã€éƒ¨ç½²ï¼‰
- âœ… æ¸¬è©¦è¦†è“‹ >80%
- âœ… ç„¡é«˜å„ªå…ˆç´šæœªä¿®å¾©å•é¡Œ
- âœ… æ•ˆèƒ½é”æ¨™ï¼ˆç™»å…¥ <2 min, é é¢ <3 secï¼‰
- âœ… å®‰å…¨æ€§å¯©è¨ˆé€šé

---

## ğŸ“ˆ é€²åº¦è¿½è¹¤ç¯„æœ¬

```markdown
## Weekly Progress

### Week 1
- [ ] Phase 1-2: Infrastructure (T001-T023)
- [ ] Phase 3: Google OAuth MVP (T024-T033)
- **Status**: [On Track / At Risk / Blocked]

### Week 2
- [ ] Phase 4: Magic Link (T034-T043)
- [ ] Phase 5: RBAC Setup (T044-T049)
- **Status**: [On Track / At Risk / Blocked]

### Week 3
- [ ] Phase 6: Session Management (T050-T058)
- [ ] Phase 7: Audit & Security (T059-T067)
- **Status**: [On Track / At Risk / Blocked]

### Week 4+
- [ ] Phase 8-9: P2 Features (T068-T078)
- [ ] Phase 10-12: Testing, Docs, Polish (T079-T100)
- **Status**: [On Track / At Risk / Blocked]
```

---

## ğŸš€ å»ºè­°ç¬¬ä¸€è¡åˆºï¼ˆ2 é€±ï¼‰

**Focus**: P1 MVP - Google OAuth + Magic Link + RBAC + åŸºæœ¬å·¥ä½œéšæ®µ

### Sprint 1: Setup & OAuth
- Phase 1: åŸºç¤è¨­æ–½ (T001-T013)
- Phase 2: å‰ç«¯åŸºç¤ (T014-T023)
- Phase 3: Google OAuth (T024-T033)

### Sprint 2: Magic Link & Security
- Phase 4: Magic Link (T034-T043)
- Phase 5: RBAC (T044-T049)
- Phase 6: å·¥ä½œéšæ®µï¼ˆåŸºæœ¬ï¼‰(T050-T054)
- Phase 7: ç¨½æ ¸æ—¥èªŒï¼ˆåŸºæœ¬ï¼‰(T059-T067)

**After Sprint 2**:
- âœ… å®Œæ•´ç„¡å¯†ç¢¼èªè­‰å·¥ä½œæµ
- âœ… å¤šä½¿ç”¨è€…è§’è‰²æ”¯æ´
- âœ… åŸºæœ¬å®‰å…¨æ€§å’Œç¨½æ ¸
- âœ… å¯ä»¥éƒ¨ç½²åˆ°ç”Ÿç”¢

---

**Status**: âœ… ä»»å‹™æ¸…å–®ç”Ÿæˆå®Œæˆ - æº–å‚™é–‹å§‹å¯¦æ–½

**å»ºè­°å‘½ä»¤**:
```bash
git checkout 003-passwordless-auth
npm install
npm run dev
# éµå¾ª Phase 1-3 ä»»å‹™é€²è¡Œå¯¦æ–½
```
