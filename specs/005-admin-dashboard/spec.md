# 功能規格書：管理員儀表板

**功能分支**: `005-admin-dashboard`
**建立日期**: 2025-12-04
**狀態**: 草稿
**輸入**: 使用者描述："建立管理員儀表板。參考 Voyager CMS"

## 澄清 (Clarifications)

### Session 2025-12-04

- Q1: 角色權限模型 → A: 管理員擁有完整存取權；家長可查看公開文章及其孩子班級的文章；學生不登入系統，僅用於班級和家庭關聯；教師不使用管理員儀表板
- Q2: 並發編輯衝突解決 → A: 最後保存獲勝（Last Write Wins）
- Q3: 批量用戶導入驗證失敗處理 → A: 全部或無（如果任何行無效，整個導入失敗）
- Q4: 審計日誌保留期限 → A: 1 個月

## 使用者情境與測試 *(必需)*

<!--
  重要提示：使用者故事應按重要性優先排序。
  每個使用者故事/旅程必須獨立可測試 - 這意味著如果您只實現其中一個，
  您仍然應該有一個可行的最小可行產品 (MVP) 提供價值。

  為每個故事分配優先級 (P1, P2, P3 等)，其中 P1 最關鍵。
  將每個故事視為一個獨立的功能切片，可以：
  - 獨立開發
  - 獨立測試
  - 獨立部署
  - 獨立演示給使用者
-->

### 使用者故事 1 - 管理員按週查看所有電子報 (優先級: P1)

管理員使用者登入儀表板，需要快速概覽按週組織的所有電子報。他們可以看到發布狀態、文章數量和每週的基本元資料，無需開啟各個電子報。

**為何此優先級**: 核心功能，為所有其他管理員任務提供基礎。沒有此視圖，管理員無法有效管理內容。

**獨立測試**: 可以通過導航到儀表板並查看週列表來完全測試。為電子報管理可見性提供即時價值。

**驗收情境**:

1. **給定**管理員已登入，**當**他們導航到儀表板時，**則**他們看到列出所有電子報週次的表格/網格
2. **給定**顯示電子報列表，**當**他們查看每一行時，**則**他們看到週次、發布日期、文章數量和狀態
3. **給定**存在不同狀態的電子報（草稿、已發布、已封存），**當**查看列表時，**則**他們可以識別每週的狀態

---

### 使用者故事 2 - 管理員編輯文章內容和元資料 (優先級: P1)

管理員需要修改某週內文章的內容、標題、作者、分類和家族附件。他們可以從列表中選擇文章並在基於表單的介面中編輯其屬性。

**為何此優先級**: 核心內容管理功能。對於維護和更新電子報內容至關重要。

**獨立測試**: 可以通過開啟文章編輯器、修改欄位和保存更改進行測試。為內容維護提供即時價值。

**驗收情境**:

1. **給定**管理員正在查看某週的文章，**當**他們點擊一篇文章時，**則**打開編輯表單顯示所有可編輯欄位
2. **給定**編輯表單已打開，**當**他們修改文章標題、內容或作者時，**則**更改被捕獲在表單中
3. **給定**文章有相關聯的分類和家族，**當**編輯時，**則**他們可以查看和修改這些關係
4. **給定**對文章進行了更改，**當**他們點擊保存時，**則**更改持久化並出現確認訊息

---

### 使用者故事 3 - 管理員管理分類和家族 (優先級: P2)

管理員可以建立、編輯和刪除文章分類（如「科學」、「歷史」、「藝術」）和家族附件（相關主題或主題束）。他們可以管理這些組織結構以保持內容正確分類。

**為何此優先級**: 對於內容組織和搜尋/過濾功能很重要，但可以與核心編輯工作流分開管理。

**獨立測試**: 可以通過建立新分類、編輯其屬性和刪除它來測試。無需文章編輯即可提供清晰的組織優勢。

**驗收情境**:

1. **給定**管理員訪問分類管理部分，**當**他們查看列表時，**則**他們看到所有現有分類以及編輯和刪除選項
2. **給定**他們點擊「建立新分類」，**當**他們輸入名稱和描述時，**則**分類被建立並出現在列表中
3. **給定**現有分類，**當**他們點擊編輯時，**則**他們可以修改名稱和描述
4. **給定**他們想要移除分類，**當**他們點擊刪除時，**則**系統確認刪除並移除分類

---

### 使用者故事 4 - 管理員建立新電子報 (優先級: P2)

管理員可以為即將到來的一週建立新電子報，定義週次、發布日期和初始元資料。這開始了為該週填充文章的工作流程。

**為何此優先級**: 對於持續的電子報運營是必要的，但源於查看和編輯現有電子報。

**獨立測試**: 可以通過點擊「建立電子報」、填入週詳細資訊和驗證它出現在列表中來測試。為電子報規劃提供清晰價值。

**驗收情境**:

1. **給定**管理員在儀表板上，**當**他們點擊「建立新電子報」時，**則**出現用於輸入週資訊的表單
2. **給定**建立表單已打開，**當**他們輸入週次和發布日期時，**則**表單驗證輸入
3. **給定**他們提交表單，**當**所有必需欄位有效時，**則**新電子報被建立並列出在儀表板上

---

### 使用者故事 5 - 管理員發布和封存電子報 (優先級: P3)

管理員可以將電子報狀態從草稿更改為已發布，或將其移至已封存狀態。這控制了電子報對讀者的可見性和可訪問性。

**為何此優先級**: 對於工作流管理很重要，但不如建立和編輯內容那麼關鍵。

**獨立測試**: 可以通過更改電子報狀態並驗證狀態在列表中更新以及影響讀者可見性來測試。

**驗收情境**:

1. **給定**存在草稿電子報，**當**管理員點擊「發布」時，**則**狀態更改為已發布且讀者可以看到它
2. **給定**已發布的電子報，**當**管理員點擊「封存」時，**則**狀態更改為已封存且從標準讀者視圖隱藏
3. **給定**進行了狀態更改，**當**查看電子報列表時，**則**更新的狀態立即反映

---

### 使用者故事 6 - 管理員管理用戶和角色 (優先級: P1)

系統管理員需要建立、編輯和刪除用戶帳戶，並將他們指派到特定角色（管理員、教師、家長、學生）。管理員可以批量導入用戶、設定權限和管理帳戶狀態。

**為何此優先級**: 核心功能，所有其他用戶管理操作的基礎。沒有用戶和角色管理，系統無法運作。

**獨立測試**: 可以通過建立用戶帳戶、指派角色和驗證權限來完全測試。立即提供用戶管理的價值。

**驗收情境**:

1. **給定**管理員在用戶管理介面中，**當**他們點擊「新增用戶」時，**則**出現用戶建立表單
2. **給定**用戶建立表單已打開，**當**他們輸入電子郵件、姓名和角色時，**則**用戶被建立並出現在列表中
3. **給定**用戶存在，**當**管理員編輯其角色時，**則**權限立即更新

---

### 使用者故事 7 - 管理班級和班級成員 (優先級: P1)

管理員可以建立班級、新增學生到班級中，以及管理班級成員資格。班級可以組織多個學生，每個班級有自己的課程內容和家長聯絡。

**為何此優先級**: 教育機構的核心功能。班級組織是電子報和內容發布的基礎。

**獨立測試**: 可以通過建立班級、新增學生和驗證成員資格來完全測試。為班級組織提供清晰價值。

**驗收情境**:

1. **給定**管理員在班級管理部分，**當**他們點擊「建立新班級」時，**則**出現班級建立表單
2. **給定**班級已建立，**當**管理員新增學生時，**則**學生出現在班級成員列表中
3. **給定**班級存在，**當**查看班級詳細資訊時，**則**顯示所有成員及其聯絡方式

---

### 使用者故事 8 - 管理家長-學生關係 (優先級: P1)

系統支援定義家長與學生之間的關係（一對一、一對多、多對一）。家長帳戶可以連結到多個學生，學生可以有多個家長。系統維護這些關係以實現有針對性的通訊。

**為何此優先級**: 教育系統中的關鍵功能。家長-學生關係決定了通訊的接收者。

**獨立測試**: 可以通過建立家長帳戶、將其連結到學生和驗證關係來測試。為家庭通訊提供基礎價值。

**驗收情境**:

1. **給定**家長帳戶和學生帳戶存在，**當**管理員在系統中建立關係時，**則**家長可以查看他們的孩子
2. **給定**家長-學生關係已建立，**當**家長登入時，**則**他們看到他們連結的所有學生
3. **給定**一個家長有多個學生，**當**查看家庭詳細資訊時，**則**列出所有相關學生

### 邊界案例

- 當管理員嘗試刪除已指派文章的分類時會發生什麼？
- 如果兩個管理員同時開啟同一篇文章，系統如何處理並發編輯？
- 當管理員嘗試建立已存在的週次電子報時會發生什麼？
- 已刪除的文章在資料保留和審計軌跡方面如何處理？
- 當一個學生轉入或轉出班級時會發生什麼？
- 如果一個家長有多個帳戶該如何管理？
- 刪除用戶時相關的帳戶關係如何處理？
- 系統如何處理孤立用戶（無班級、無家長的學生）？
- 重複帳戶或電子郵件重複時會發生什麼？

## 需求 *(必需)*

### 功能需求

- **FR-001**: 系統必須顯示包含按週組織的所有電子報列表的儀表板
- **FR-002**: 系統必須允許管理員按狀態（草稿、已發布、已封存）查看和過濾電子報
- **FR-003**: 系統必須提供允許修改標題、內容、作者和分類指派的文章編輯器
- **FR-004**: 系統必須允許在電子報中建立新文章
- **FR-005**: 系統必須允許刪除文章並確認以防止意外移除
- **FR-006**: 系統必須支援文章分類的管理（建立、讀取、更新、刪除操作）
- **FR-007**: 系統必須支援家族附件的管理（建立、讀取、更新、刪除操作）
- **FR-008**: 系統必須允許使用週次和發布日期建立新電子報
- **FR-009**: 系統必須允許在草稿、已發布和已封存狀態之間更改電子報狀態
- **FR-010**: 系統必須為文章提供批量操作（選擇多個並應用刪除或更改分類等操作）
- **FR-011**: 系統必須在破壞性操作（刪除文章、刪除分類）前顯示確認對話框
- **FR-012**: 系統必須為所有操作（建立、更新、刪除）顯示成功/錯誤訊息
- **FR-013**: 系統必須在提交前驗證所有表單輸入（必需欄位、資料格式、適用時的唯一性）
- **FR-014**: 系統必須將所有更改持久化到後端資料庫
- **FR-015**: 系統必須提供基於角色的存取控制 - 只有管理員和家長可以訪問儀表板（教師不需要儀表板存取）
- **FR-016**: 系統必須允許管理員建立新用戶帳戶並指派角色（管理員、教師、家長、學生）
- **FR-015a**: 系統必須限制家長只能查看公開文章和其孩子所在班級的文章
- **FR-015b**: 系統必須防止學生帳戶登入（學生帳戶僅用於班級和家庭關聯）
- **FR-017**: 系統必須允許管理員編輯用戶詳細資訊（姓名、電子郵件、電話、角色）
- **FR-018**: 系統必須允許管理員刪除用戶帳戶並處理相關關係
- **FR-019**: 系統必須支援批量用戶導入（透過 CSV 或其他格式），採用全部或無策略（如果任何行無效，整個導入失敗）
- **FR-019a**: 系統必須在導入失敗時提供詳細的錯誤訊息，指出哪些記錄因何原因失敗
- **FR-020**: 系統必須允許管理員建立班級並管理班級成員
- **FR-021**: 系統必須支援班級中的學生管理（新增、移除、轉移）
- **FR-022**: 系統必須允許定義和管理家長-學生關係
- **FR-023**: 系統必須支援一個家長有多個學生的一對多關係
- **FR-024**: 系統必須支援一個學生有多個家長的多對一關係
- **FR-025**: 系統必須驗證電子郵件的唯一性以防止重複帳戶
- **FR-026**: 系統必須支援用戶狀態管理（活躍、停用、待審批）
- **FR-027**: 系統必須記錄所有用戶管理操作以進行審計追蹤，保留期限為 1 個月
- **FR-028**: 系統必須在並發編輯時實現最後保存獲勝（Last Write Wins）策略

### 關鍵實體

- **電子報**: 代表週刊出版物，具有週次、發布日期、文章數量和狀態
- **文章**: 屬於電子報的內容片段，具有標題、內容、作者、發布狀態以及相關聯的分類/家族
- **分類**: 文章的組織類別（例如「科學」、「歷史」），具有名稱和描述
- **家族**: 主題束或相關內容分組，文章可以附加到其中
- **用戶**: 系統的個人帳戶，具有電子郵件、姓名、角色、狀態和權限
- **角色**: 定義用戶權限的類別（管理員、教師、家長、學生）
- **班級**: 由教師管理的學生群組，具有班級名稱、年級和成員列表
- **家庭關係**: 連結家長和學生的關聯，支援一對多和多對一關係

## 成功標準 *(必需)*

### 可測量成果

- **SC-001**: 管理員可以在標準網路連線下在 2 秒內加載包含所有電子報的儀表板
- **SC-002**: 建立新文章或電子報從表單提交到確認在 5 秒內完成
- **SC-003**: 文章、分類和家族上的所有 CRUD 操作（建立、讀取、更新、刪除）無錯誤地工作
- **SC-004**: 表單驗證在使用者輸入時提供即時反饋（在 500 毫秒內）
- **SC-005**: 至少 95% 的管理員操作在首次嘗試時成功完成，無需重試
- **SC-006**: 儀表板支援管理至少 500 個電子報和 5,000 篇文章，無明顯性能降低
- **SC-007**: 管理員可以在 3 分鐘內完成典型工作流程（編輯文章、更改狀態、發布）
- **SC-008**: 所有破壞性操作（刪除）需要明確確認，防止意外資料遺失
- **SC-009**: 儀表板為所有內容（草稿/已發布/已封存）顯示清晰的狀態指示，立即可辨認
- **SC-010**: 管理員可以在 2 分鐘內建立新用戶帳戶
- **SC-011**: 批量導入最多支援 10,000 個用戶，導入時間不超過 5 分鐘
- **SC-012**: 教師可以在 1 分鐘內建立新班級並新增學生
- **SC-013**: 系統支援至少 500 個班級和 50,000 個用戶關係管理，無明顯性能降低
- **SC-014**: 家長-學生關係查詢在 500 毫秒內返回，無延遲
- **SC-015**: 存取控制在所有頁面上立即執行，防止未授權存取

## 假設

- **認證**: 管理員和家長已經過身份驗證，存取控制由現有認證系統執行（Spec 003 的無密碼認證）
- **資料庫**: Supabase 資料庫，具有現有的電子報、文章、分類、家族、用戶、班級和關係結構可用
- **使用者權限**: 管理員擁有完整 CRUD 權限；家長為唯讀存取；教師不使用此儀表板；學生不登入
- **資料驗證**: 將執行後端 API 的現有驗證規則
- **樣式設定**: 儀表板將使用現有的 Tailwind CSS 主題和 Waldorf 調色板以保持一致性
- **媒體處理**: 具有多媒體支援的富文本編輯器 (TipTap) 已可用於文章編輯
- **搜尋/過濾**: 需要按狀態進行基本過濾；進階搜尋/過濾可在未來階段添加
- **認證系統**: 現有的認證系統可以支援多種角色
- **電子郵件驗證**: 系統假設電子郵件地址為有效且可驗證的
- **批量導入格式**: CSV 格式支援標準列（電子郵件、姓名、角色、班級等）
- **預設權限**: 系統為每個角色預設一組權限，管理員可以自訂
- **資料保留**: 刪除的用戶資訊保留在系統中用於審計目的，但被軟刪除（標記為停用而不是物理刪除）
