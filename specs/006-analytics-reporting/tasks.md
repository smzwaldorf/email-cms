# å¯¦ä½œä»»å‹™åˆ—è¡¨ï¼šåˆ†æèˆ‡å ±è¡¨ç³»çµ±

**åˆ†æ”¯**: `006-analytics-reporting`
**ç‹€æ…‹**: ğŸ“‹ æº–å‚™å¯¦ä½œï¼Œ64% æ¶æ§‹é‡ç”¨é©—è­‰å®Œæˆ
**é ä¼°å·¥ä½œé‡**: 4-6 é€±ï¼ˆ104 å€‹ä»»å‹™ï¼‰
**å„ªå…ˆé †åº**: 5 å€‹ä½¿ç”¨è€…æ•…äº‹ (P1: 2å€‹, P2: 3å€‹)

---

## ğŸ¯ æ¶æ§‹é‡ç”¨å„ªåŒ–

> âœ… **64% Schema Reuse Verified** - 6 existing tables reused, only 3 new tables required
> ğŸ“„ è©³è¦‹: [SCHEMA-REUSE-ANALYSIS.md](./SCHEMA-REUSE-ANALYSIS.md)

**Reused Tables** (é›¶æ”¹å‹•):
- âœ… `user_roles` - User/recipient tracking
- âœ… `child_class_enrollment` - Parent-child relationships
- âœ… `family_enrollment` - Family grouping
- âœ… `articles` - Article metadata
- âœ… `newsletter_weeks` - Time-based aggregation
- âœ… `classes` - Class/cohort analysis

**New Tables** (æœ€å°åŒ–):
- ğŸ†• `analytics_events` - Raw event tracking
- ğŸ†• `analytics_snapshots` - Daily aggregation
- ğŸ†• `tracking_tokens` - JWT management
- ğŸ†• `tracking_links` (optional, Phase 8) - URL mapping

**Benefits**:
- â±ï¸ ç¯€çœ 1-2 å¤©è¨­è¨ˆæ™‚é–“
- ğŸ”’ 100% å‘å¾Œç›¸å®¹æ€§
- ğŸš« é›¶ç ´å£æ€§æ”¹å‹•
- âœ… å…¨ç¾æœ‰ç´¢å¼•å¯è¤‡ç”¨

---

## ğŸ“Š ä»»å‹™çµ±è¨ˆ

| éšæ®µ | æè¿° | ä»»å‹™æ•¸ | é è¨ˆå·¥æ™‚ |
|------|------|--------|---------|
| Phase 1 | åŸºç¤æ¶æ§‹èˆ‡æ•¸æ“šåº« (3 æ–°è¡¨) | 15 | 1 é€± |
| Phase 2 | è¿½è¹¤ä»¤ç‰Œèˆ‡æœå‹™ | 12 | 1 é€± |
| Phase 3 | å‰ç«¯è¿½è¹¤å¯¦ç¾ | 14 | 1 é€± |
| Phase 4 | API ç«¯é»èˆ‡å„ªåŒ– | 13 | 1 é€± |
| Phase 5 | èšåˆèˆ‡æŸ¥è©¢å„ªåŒ– | 12 | 1 é€± |
| Phase 6 | å„€è¡¨æ¿ UI (MVP) | 18 | 1.5 é€± |
| Phase 7 | é€²éšå„€è¡¨æ¿åŠŸèƒ½ | 10 | 1 é€± |
| Phase 8 | å°å‡ºèˆ‡å ±è¡¨ | 8 | 1 é€± |
| Phase 9 | æ¸¬è©¦èˆ‡æ–‡æª” | 12 | 1 é€± |

**ç¸½è¨ˆ**: 104 å€‹ä»»å‹™ | **4-6 é€±å®Œæˆ** | **æ¸¬è©¦è¦†è“‹**: 95%+

---

## Phase 1: åŸºç¤æ¶æ§‹èˆ‡æ•¸æ“šåº«ï¼ˆ1 é€±ï¼‰

**ç›®çš„**: å»ºç«‹æ•¸æ“šæŒä¹…åŒ–åŸºç¤å’Œè¡¨çµæ§‹ï¼ˆåƒ…éœ€æ·»åŠ  3 å€‹æ–°è¡¨ï¼Œç„¡ç¾å­˜è¡¨æ”¹å‹•ï¼‰

### æ•¸æ“šåº«é·ç§»

> ğŸ“Œ **æ¶æ§‹èªªæ˜**: ä»¥ä¸‹ 3 å€‹æ–°è¡¨é€é FK é€£æ¥åˆ° 6 å€‹æ—¢æœ‰è¡¨
> - `analytics_events.user_id` â†’ `user_roles.id` âœ…
> - `analytics_events.newsletter_id` â†’ `newsletter_weeks.week_number` âœ…
> - `analytics_events.article_id` â†’ `articles.id` âœ…
> - `analytics_snapshots` é¡ä¼¼é€£æ¥åˆ°æ—¢æœ‰è¡¨ âœ…

- [ ] **T001** [P] å»ºç«‹å–®ä¸€é·ç§»æ–‡ä»¶ï¼š`supabase/migrations/20251205_000_add_analytics_tables.sql`
  - åŒ…å«: 3 å€‹æ–°è¡¨å®šç¾© + RLS æ”¿ç­– + ç´¢å¼•
  - æª”æ¡ˆ: `supabase/migrations/20251205_000_add_analytics_tables.sql`
  - é©—æ”¶: é·ç§»æª”æ¡ˆåŒ…å«æ‰€æœ‰ 3 å€‹è¡¨ + FK + ç´¢å¼• + RLS

- [ ] **T002** [P] åœ¨é·ç§»æ–‡ä»¶ä¸­å®šç¾© `analytics_events` è¡¨
  - å­—æ®µ: id, user_id (FK), newsletter_id (FK), article_id (FK), session_id, event_type, metadata, created_at
  - ç´¢å¼•: user_id, newsletter_id, article_id, session_id, created_at
  - FK: é€£æ¥åˆ° user_roles, newsletter_weeks, articles (å‡ç‚ºæ—¢æœ‰è¡¨)
  - é©—æ”¶: è¡¨çµæ§‹æ­£ç¢ºï¼Œæ‰€æœ‰ FK æœ‰æ•ˆ

- [ ] **T003** [P] åœ¨é·ç§»æ–‡ä»¶ä¸­å®šç¾© `analytics_snapshots` è¡¨
  - å­—æ®µ: id, snapshot_date, newsletter_id (FK), article_id (FK), class_id (FK), metric_name, metric_value, created_at
  - ç´¢å¼•: snapshot_date, newsletter_id, article_id, class_id
  - FK: é€£æ¥åˆ° newsletter_weeks, articles, classes (å‡ç‚ºæ—¢æœ‰è¡¨)
  - é©—æ”¶: è¡¨çµæ§‹æ”¯æ´æ—¥èšåˆæŸ¥è©¢

- [ ] **T004** [P] åœ¨é·ç§»æ–‡ä»¶ä¸­å®šç¾© `tracking_tokens` è¡¨
  - å­—æ®µ: id, user_id (FK), token_hash, token_payload, is_revoked, created_at, expires_at
  - ç´¢å¼•: user_id, token_hash (unique), expires_at
  - FK: é€£æ¥åˆ° user_roles (æ—¢æœ‰è¡¨)
  - é©—æ”¶: æ”¯æ´ä»¤ç‰Œæ’¤éŠ·å’ŒéæœŸæª¢æŸ¥

- [ ] **T005** [P] åœ¨é·ç§»æ–‡ä»¶ä¸­å®šç¾© `tracking_links` è¡¨ (å¯é¸ï¼ŒPhase 8)
  - å­—æ®µ: id, original_url, article_id (FK), newsletter_id (FK), created_at
  - FK: é€£æ¥åˆ° articles, newsletter_weeks (æ—¢æœ‰è¡¨)
  - é©—æ”¶: æ”¯æ´é‡å®šå‘æ˜ å°„
  - æ³¨: æ­¤è¡¨å¯å»¶å¾Œè‡³ Phase 8 å¯¦ä½œï¼Œä¸å½±éŸ¿ MVP

### RLS æ”¿ç­–

> ğŸ“Œ **é‡ç”¨ç¾æœ‰æ¨¡å¼**: RLS æ”¿ç­–æ²¿ç”¨ `auth_events` è¡¨çš„è¨­è¨ˆæ¨¡å¼ï¼ˆå·²é©—è­‰å®‰å…¨ï¼‰
> - ç®¡ç†å“¡ï¼šæŸ¥çœ‹å…¨éƒ¨æ•¸æ“š
> - ä½¿ç”¨è€…ï¼šæŸ¥çœ‹è‡ªå·±æˆ–ç›¸é—œç­ç´šçš„æ•¸æ“š
> - çˆ¶æ¯ï¼šæŸ¥çœ‹å­å¥³ç­ç´šçš„æ•¸æ“š

- [ ] **T006** [P] åœ¨é·ç§»æ–‡ä»¶ä¸­å¯¦ç¾ `analytics_events` çš„ RLS æ”¿ç­–
  - æ”¿ç­–: SELECT å…è¨±ç”¨æˆ¶æŸ¥çœ‹è‡ªå·±çš„äº‹ä»¶ï¼Œç®¡ç†å“¡æŸ¥çœ‹å…¨éƒ¨
  - æ”¿ç­–: INSERT å…è¨±æœå‹™è§’è‰² (trackingService) æ’å…¥äº‹ä»¶
  - æª”æ¡ˆ: åœ¨ `supabase/migrations/20251205_000_add_analytics_tables.sql` ä¸­å®šç¾©
  - é©—æ”¶: æ”¿ç­–æ¸¬è©¦é€šéï¼Œä½¿ç”¨è€…åªèƒ½æŸ¥çœ‹è‡ªå·±çš„æ•¸æ“šï¼Œç®¡ç†å“¡å¯æŸ¥çœ‹å…¨éƒ¨

- [ ] **T007** [P] åœ¨é·ç§»æ–‡ä»¶ä¸­å¯¦ç¾ `analytics_snapshots` çš„ RLS æ”¿ç­–
  - æ”¿ç­–: SELECT å…è¨±ç”¨æˆ¶æŸ¥çœ‹è‡ªå·±ç­ç´šçš„ snapshotï¼Œç®¡ç†å“¡æŸ¥çœ‹å…¨éƒ¨
  - ä½¿ç”¨ `child_class_enrollment` è¡¨é€²è¡Œç­ç´šç´šåˆ¥çš„è¨ªå•æ§åˆ¶
  - æª”æ¡ˆ: åœ¨ `supabase/migrations/20251205_000_add_analytics_tables.sql` ä¸­å®šç¾©
  - é©—æ”¶: ç­ç´šç´šåˆ¥çš„è¨ªå•æ§åˆ¶å·¥ä½œæ­£ç¢ºï¼Œçˆ¶æ¯åªèƒ½çœ‹è‡ªå·±å­å¥³ç­ç´šçš„çµ±è¨ˆ

- [ ] **T008** [P] åœ¨é·ç§»æ–‡ä»¶ä¸­å¯¦ç¾ `tracking_tokens` çš„ RLS æ”¿ç­–
  - æ”¿ç­–: SELECT/UPDATE å…è¨±ç”¨æˆ¶ç®¡ç†è‡ªå·±çš„ä»¤ç‰Œï¼Œç®¡ç†å“¡ç®¡ç†å…¨éƒ¨
  - æ”¿ç­–: INSERT å…è¨±èªè­‰æœå‹™ç”Ÿæˆæ–°ä»¤ç‰Œ
  - æª”æ¡ˆ: åœ¨ `supabase/migrations/20251205_000_add_analytics_tables.sql` ä¸­å®šç¾©
  - é©—æ”¶: æ”¿ç­–æ¸¬è©¦é€šéï¼Œä»¤ç‰Œæ’¤éŠ·å’ŒéæœŸæª¢æŸ¥æ­£å¸¸å·¥ä½œ

### é¡å‹å®šç¾©

> ğŸ“Œ **æ¶æ§‹æ•´åˆ**: æ–°é¡å‹éœ€èˆ‡æ—¢æœ‰çš„ `user_roles`ã€`articles`ã€`newsletter_weeks`ã€`classes` é¡å‹æ•´åˆ

- [ ] **T009** [P] å»ºç«‹ `src/types/analytics.ts`
  - é¡å‹: `AnalyticsEvent`ã€`AnalyticsSnapshot`ã€`TrackingToken`ã€`TrackingPayload`ã€`AnalyticsMetrics`
  - FK åƒè€ƒ: `user_id` åƒè€ƒ `user_roles.id`ã€`newsletter_id` åƒè€ƒ `newsletter_weeks`ã€`article_id` åƒè€ƒ `articles`ã€`class_id` åƒè€ƒ `classes`
  - æª”æ¡ˆ: `src/types/analytics.ts`
  - é©—æ”¶: æ‰€æœ‰é¡å‹åŒ¯å‡ºä¸¦å¯åœ¨æ•´å€‹æ‡‰ç”¨ä¸­ä½¿ç”¨ï¼ŒFK é¡å‹ç›¸å®¹

- [ ] **T010** [P] å»ºç«‹ `src/types/tracking.ts`
  - é¡å‹: `TrackingEventType`ã€`TrackingMetadata`ã€`SessionData`ã€`JWTPayload`ã€`TokenRevocationReason`
  - äº‹ä»¶é¡å‹: 'page_view'ã€'scroll_50'ã€'scroll_90'ã€'link_click'ã€'session_end'ã€'email_open'
  - æª”æ¡ˆ: `src/types/tracking.ts`
  - é©—æ”¶: é¡å‹å®šç¾©å®Œæ•´ä¸”ç„¡è¡çªï¼Œæ”¯æ´æ‰€æœ‰è¿½è¹¤äº‹ä»¶é¡å‹

### ç’°å¢ƒé…ç½®

- [ ] **T011** [P] æ›´æ–° `.env.local` ç‚ºåˆ†æé…ç½®
  - ç’°å¢ƒè®Šæ•¸:
    - `VITE_JWT_SECRET` - JWT ç°½åå¯†é‘°ï¼ˆä¾†è‡ª Supabase è¨­å®šï¼‰
    - `VITE_TRACKING_API_BASE` - è¿½è¹¤ API åŸºç¤ URLï¼ˆå¦‚ `https://api.example.com/tracking`ï¼‰
    - `VITE_TRACKING_ENABLED` - å•Ÿç”¨/ç¦ç”¨è¿½è¹¤çš„é–‹é—œ
  - æª”æ¡ˆ: `.env.local`
  - é©—æ”¶: ç’°å¢ƒè®Šæ•¸åœ¨æ‡‰ç”¨ä¸­å¯è®€ï¼Œnpm run dev å¯æ­£å¸¸å•Ÿå‹•

- [ ] **T012** [P] å»ºç«‹ `src/config/analytics.ts` é…ç½®æ–‡ä»¶
  - é…ç½®é …:
    - `trackingPixelSize` - è¿½è¹¤åƒç´ å°ºå¯¸ (1x1)
    - `eventThrottleMs` - äº‹ä»¶ç¯€æµå»¶é² (500ms)
    - `sessionIdStorageKey` - sessionStorage éµå
    - `tokenExpiryDays` - JWT ä»¤ç‰Œæœ‰æ•ˆæœŸ (14 å¤©)
    - `retentionMonths` - äº‹ä»¶ä¿ç•™æœˆæ•¸ (12 å€‹æœˆ)
  - æª”æ¡ˆ: `src/config/analytics.ts`
  - é©—æ”¶: é…ç½®åœ¨æœå‹™ä¸­å¯ç”¨ï¼Œæ‰€æœ‰æœå‹™å¯è®€å–é…ç½®å€¼

### æ¸¬è©¦èˆ‡é©—è­‰

- [ ] **T013** [P] åŸ·è¡Œæ•¸æ“šåº«é·ç§»ä¸¦é©—è­‰
  - å‘½ä»¤: `supabase migration up` æˆ– `npm run db:migrate`
  - æª”æ¡ˆ: `supabase/migrations/20251205_000_add_analytics_tables.sql`
  - é©—æ”¶:
    - é·ç§»æˆåŠŸåŸ·è¡Œ
    - 3 å€‹æ–°è¡¨ (`analytics_events`ã€`analytics_snapshots`ã€`tracking_tokens`) åœ¨æ•¸æ“šåº«ä¸­å­˜åœ¨
    - æ‰€æœ‰ç´¢å¼•å»ºç«‹æˆåŠŸ
    - RLS æ”¿ç­–å·²å•Ÿç”¨ä¸¦ç”Ÿæ•ˆ

- [ ] **T014** [P] é©—è­‰ TypeScript ç·¨è­¯
  - å‘½ä»¤: `npm run build`
  - æª”æ¡ˆ: æ–°å»ºçš„ `src/types/analytics.ts` å’Œ `src/types/tracking.ts`
  - é©—æ”¶: ç·¨è­¯æˆåŠŸï¼Œç„¡ TypeScript é¡å‹éŒ¯èª¤

- [ ] **T015** [P] é©—è­‰ç¾æœ‰æ¸¬è©¦å’ŒåŠŸèƒ½æœªå—å½±éŸ¿
  - å‘½ä»¤: `npm test -- --run`
  - é©—æ”¶:
    - æ‰€æœ‰ç¾æœ‰æ¸¬è©¦ä»ç„¶é€šé (1705+ æ¸¬è©¦)
    - ç„¡å›æ­¸éŒ¯èª¤
    - æ•¸æ“šåº«é€£æ¥æ­£å¸¸
    - æ—¢æœ‰è¡¨æ•¸æ“šå®Œæ•´æ€§æœªå—å½±éŸ¿

---

## Phase 2: è¿½è¹¤ä»¤ç‰Œèˆ‡æœå‹™ï¼ˆ1 é€±ï¼‰

**ç›®çš„**: å¯¦ç¾ JWT ä»¤ç‰Œç”Ÿæˆã€é©—è­‰å’Œæ’¤éŠ·

### ä»¤ç‰Œæœå‹™å¯¦ç¾

- [ ] **T016** [P] å»ºç«‹ `src/services/trackingTokenService.ts`
  - å‡½æ•¸: generateToken(), verifyToken(), revokeToken()
  - é©—æ”¶: åŸºæœ¬å‡½æ•¸å¯¦ç¾ä¸¦å¯æ¸¬è©¦

- [ ] **T017** å¯¦ç¾ `generateToken()` å‡½æ•¸
  - åŠŸèƒ½: ç”Ÿæˆ JWTï¼ŒåŒ…å« userId, newsletterId, classIds, issuedAt, expiresAt
  - ç°½åç®—æ³•: HS256
  - éæœŸæ™‚é–“: 14 å¤©
  - é©—æ”¶: ç”Ÿæˆçš„ä»¤ç‰Œå¯é©—è­‰

- [ ] **T018** å¯¦ç¾ `verifyToken()` å‡½æ•¸
  - åŠŸèƒ½: é©—è­‰ JWT ç°½åã€æª¢æŸ¥éæœŸæ™‚é–“ã€æª¢æŸ¥æ’¤éŠ·ç‹€æ…‹
  - é©—æ”¶: æœ‰æ•ˆä»¤ç‰Œé©—è­‰é€šéï¼Œç„¡æ•ˆä»¤ç‰Œæ‹’çµ•

- [ ] **T019** å¯¦ç¾ `revokeToken()` å‡½æ•¸
  - åŠŸèƒ½: æ¨™è¨˜ä»¤ç‰Œç‚ºå·²æ’¤éŠ·ï¼Œæ›´æ–° `is_revoked = true`
  - é©—æ”¶: å·²æ’¤éŠ·ä»¤ç‰Œé©—è­‰å¤±æ•—

- [ ] **T020** [P] å¯¦ç¾ `getTokenHash()` è¼”åŠ©å‡½æ•¸
  - åŠŸèƒ½: ç”Ÿæˆä»¤ç‰Œçš„ SHA256 å“ˆå¸Œç”¨æ–¼å¿«é€ŸæŸ¥æ‰¾
  - é©—æ”¶: å“ˆå¸Œå€¼å¯é‡è¤‡ç”Ÿæˆä¸”ä¸€è‡´

### ä»¤ç‰Œå­˜å„²èˆ‡ç®¡ç†

- [ ] **T021** å¯¦ç¾ `storeToken()` å‡½æ•¸
  - åŠŸèƒ½: å°‡ä»¤ç‰Œå“ˆå¸Œå’Œæœ‰æ•ˆè¼‰è·å­˜å„²åˆ° Supabase
  - é©—æ”¶: ä»¤ç‰Œå„²å­˜æˆåŠŸï¼Œå¯æŸ¥è©¢

- [ ] **T022** å¯¦ç¾ `checkTokenRevoked()` å‡½æ•¸
  - åŠŸèƒ½: æŸ¥è©¢ Supabase æª¢æŸ¥ä»¤ç‰Œæ’¤éŠ·ç‹€æ…‹
  - é©—æ”¶: æº–ç¢ºåæ˜ æ’¤éŠ·ç‹€æ…‹

- [ ] **T023** [P] å¯¦ç¾æ‰¹é‡æ’¤éŠ·å‡½æ•¸
  - åŠŸèƒ½: ç‚ºç”¨æˆ¶æ’¤éŠ·æ‰€æœ‰èˆŠä»¤ç‰Œï¼ˆå¦‚å¯†ç¢¼é‡ç½®ï¼‰
  - é©—æ”¶: æ‰€æœ‰åŒ¹é…ä»¤ç‰Œè¢«æ’¤éŠ·

### å®‰å…¨æ€§èˆ‡æ¸¬è©¦

- [ ] **T024** å»ºç«‹ `tests/unit/services/trackingTokenService.test.ts`
  - æ¸¬è©¦: ä»¤ç‰Œç”Ÿæˆã€é©—è­‰ã€æ’¤éŠ·ã€éæœŸæª¢æŸ¥
  - æ¶µè“‹ç‡ç›®æ¨™: 95%+
  - é©—æ”¶: æ‰€æœ‰æ¸¬è©¦é€šé

- [ ] **T025** [P] å®‰å…¨æ€§å¯©æŸ¥
  - æª¢æŸ¥: ä»¤ç‰Œç°½åå¼·åº¦ã€é˜²æ­¢é‡æ”¾æ”»æ“Šã€æ™‚é–“é©—è­‰
  - é©—æ”¶: ç„¡å·²çŸ¥æ¼æ´

- [ ] **T026** é›†æˆç’°å¢ƒè®Šæ•¸ç®¡ç†
  - åŠŸèƒ½: å¾ `.env.local` è®€å– `JWT_SECRET`
  - é©—æ”¶: é…ç½®å¯é ä¸”å®‰å…¨

- [ ] **T027** å¯¦ç¾ä»¤ç‰Œåˆ·æ–°æ©Ÿåˆ¶ï¼ˆå¯é¸ï¼‰
  - åŠŸèƒ½: ç”¨æˆ¶åœ¨ä»¤ç‰Œå³å°‡éæœŸæ™‚å¯ç”³è«‹æ–°ä»¤ç‰Œ
  - é©—æ”¶: åˆ·æ–°æµç¨‹å·¥ä½œ

---

## Phase 3: å‰ç«¯è¿½è¹¤å¯¦ç¾ï¼ˆ1 é€±ï¼‰

**ç›®çš„**: å»ºç«‹ç”¨æˆ¶ç«¯äº‹ä»¶æ•ç²å’Œç™¼é€

### è¿½è¹¤ Hook å¯¦ç¾

- [ ] **T028** [P] å»ºç«‹ `src/hooks/useAnalyticsTracking.ts`
  - åŠŸèƒ½: ä»¤ç‰Œé©—è­‰ã€æœƒè©±åˆå§‹åŒ–ã€äº‹ä»¶ç™¼é€è¨­ç½®
  - é©—æ”¶: Hook å¯åœ¨ä»»ä½•çµ„ä»¶ä¸­ä½¿ç”¨

- [ ] **T029** å¯¦ç¾æœƒè©±ç®¡ç†é‚è¼¯
  - åŠŸèƒ½: ç”Ÿæˆå”¯ä¸€ sessionIdï¼Œå„²å­˜åˆ° sessionStorage
  - é©—æ”¶: æ¯æ¬¡é é¢åŠ è¼‰ç”Ÿæˆæ–° session ID

- [ ] **T030** å¯¦ç¾ä»¤ç‰Œæå–å’Œé©—è­‰
  - åŠŸèƒ½: å¾ URL æŸ¥è©¢åƒæ•¸æå– `?t=TOKEN`ï¼Œé©—è­‰ç°½å
  - é©—æ”¶: ç„¡æ•ˆä»¤ç‰Œå°è‡´é‡å®šå‘åˆ°ç™»å…¥

- [ ] **T031** å¯¦ç¾æœƒè©±é–‹å§‹äº‹ä»¶
  - åŠŸèƒ½: ä»¤ç‰Œé©—è­‰å¾Œç«‹å³è¨˜éŒ„ `page_view` äº‹ä»¶
  - é©—æ”¶: äº‹ä»¶è¨˜éŒ„åˆ° Supabase

### äº‹ä»¶è¿½è¹¤é‚è¼¯

- [ ] **T032** [P] å»ºç«‹ `src/services/analyticsService.ts`
  - å‡½æ•¸: trackEvent(), recordScrollDepth(), recordSessionEnd()
  - é©—æ”¶: æœå‹™å¯åœ¨æ‡‰ç”¨ä¸­ä½¿ç”¨

- [ ] **T033** å¯¦ç¾ `trackEvent()` å‡½æ•¸
  - åŠŸèƒ½: ç™¼é€äº‹ä»¶åˆ° APIï¼ŒåŒ…å« sessionId, event_type, article_id, metadata
  - é©—æ”¶: äº‹ä»¶æˆåŠŸç™¼é€

- [ ] **T034** [P] å¯¦ç¾æ»¾å‹•è¿½è¹¤
  - åŠŸèƒ½: ç›£è½æ»¾å‹•äº‹ä»¶ï¼Œåœ¨ 50% å’Œ 90% æ™‚è¨˜éŒ„
  - ç¯€æµ: é˜²æ­¢éåº¦è§¸ç™¼ï¼ˆæœ€å¤š 1 æ¬¡/50%ï¼Œ1 æ¬¡/90%ï¼‰
  - é©—æ”¶: æ»¾å‹•äº‹ä»¶å‡†ç¢ºè¨˜éŒ„

- [ ] **T035** å¯¦ç¾åœç•™æ™‚é–“è¨ˆç®—
  - åŠŸèƒ½: è¨˜éŒ„é€²å…¥å’Œé›¢é–‹æ™‚é–“ï¼Œè¨ˆç®—åœç•™æ™‚é•·
  - é©—æ”¶: åœç•™æ™‚é•·å‡†ç¢º

- [ ] **T036** [P] å¯¦ç¾æœƒè©±çµæŸäº‹ä»¶
  - åŠŸèƒ½: ç”¨æˆ¶é›¢é–‹é é¢æˆ–é—œé–‰æ¨™ç±¤æ™‚è¨˜éŒ„ `session_end`
  - äº‹ä»¶: `beforeunload`ã€`pagehide`
  - é©—æ”¶: æœƒè©±çµæŸäº‹ä»¶è¨˜éŒ„

### èˆ‡çµ„ä»¶é›†æˆ

- [ ] **T037** åœ¨ `ArticleContent.tsx` ä¸­é›†æˆè¿½è¹¤
  - ä¿®æ”¹: æ·»åŠ  `useAnalyticsTracking()` å’Œæ»¾å‹•ç›£è½
  - é©—æ”¶: æ–‡ç« è¨ªå•è¢«è¿½è¹¤

- [ ] **T038** [P] åœ¨ `WeeklyReaderPage.tsx` ä¸­é›†æˆè¿½è¹¤
  - ä¿®æ”¹: æ·»åŠ è¿½è¹¤ Hook
  - é©—æ”¶: é€±å ±è¨ªå•è¢«è¿½è¹¤

- [ ] **T039** å»ºç«‹ `tests/unit/hooks/useAnalyticsTracking.test.ts`
  - æ¸¬è©¦: ä»¤ç‰Œé©—è­‰ã€æœƒè©±åˆå§‹åŒ–ã€äº‹ä»¶ç™¼é€
  - é©—æ”¶: æ‰€æœ‰æ¸¬è©¦é€šé

- [ ] **T040** [P] é›†æˆæ¸¬è©¦ï¼šè¿½è¹¤æµç¨‹
  - æª”æ¡ˆ: `tests/integration/analytics-tracking-flow.test.ts`
  - æ¸¬è©¦: å¾ä»¤ç‰Œé©—è­‰åˆ°äº‹ä»¶è¨˜éŒ„çš„å®Œæ•´æµç¨‹
  - é©—æ”¶: æµç¨‹å·¥ä½œæ­£å¸¸

- [ ] **T041** æ€§èƒ½æ¸¬è©¦
  - æª”æ¡ˆ: `tests/performance/analytics-tracking-performance.test.ts`
  - ç›®æ¨™: äº‹ä»¶ç™¼é€ <50ms
  - é©—æ”¶: æ€§èƒ½æŒ‡æ¨™é”æˆ

---

## Phase 4: API ç«¯é»èˆ‡å„ªåŒ–ï¼ˆ1 é€±ï¼‰

**ç›®çš„**: å¯¦ç¾è¿½è¹¤åƒç´ å’Œé‡å®šå‘ç«¯é»

### è¿½è¹¤åƒç´ ç«¯é»

- [ ] **T042** [P] å»ºç«‹ `api/tracking/pixel.ts` Supabase å‡½æ•¸
  - ç«¯é»: `GET /api/tracking/pixel/:newsletterId?t=TOKEN`
  - åŠŸèƒ½: é©—è­‰ä»¤ç‰Œã€è¨˜éŒ„ email_open äº‹ä»¶ã€è¿”å› GIF
  - é©—æ”¶: ç«¯é»å·¥ä½œï¼Œè¿”å› 1x1 GIF

- [ ] **T043** å¯¦ç¾ email_open äº‹ä»¶è¨˜éŒ„
  - åŠŸèƒ½: å¾ä»¤ç‰Œæå– userIdï¼Œè¨˜éŒ„ email_open äº‹ä»¶
  - é©—æ”¶: äº‹ä»¶å„²å­˜åˆ° analytics_events

- [ ] **T044** [P] å¯¦ç¾é‡è¤‡æª¢æ¸¬ï¼ˆ10 ç§’å»é‡ï¼‰
  - åŠŸèƒ½: åŒç”¨æˆ¶åœ¨ 10 ç§’å…§çš„å¤šæ¬¡é–‹å•Ÿåªè¨ˆä¸€æ¬¡
  - é©—æ”¶: é‡è¤‡æª¢æ¸¬å·¥ä½œ

- [ ] **T045** å¯¦ç¾è¿”å›è¿½è¹¤åƒç´ 
  - åŠŸèƒ½: è¿”å› 1x1 é€æ˜ GIF
  - å„ªåŒ–: ç·©å­˜ GIF è³‡æº
  - é©—æ”¶: éƒµä»¶å®¢æˆ¶ç«¯æ­£ç¢ºé¡¯ç¤ºï¼ˆç„¡å‘ˆç¾å»¶é²ï¼‰

### é‡å®šå‘è¿½è¹¤ç«¯é»

- [ ] **T046** [P] å»ºç«‹ `api/tracking/click.ts` Supabase å‡½æ•¸
  - ç«¯é»: `GET /api/tracking/click/:trackingLinkId?t=TOKEN&redirect=true`
  - åŠŸèƒ½: é©—è­‰ä»¤ç‰Œã€è¨˜éŒ„ link_click äº‹ä»¶ã€é‡å®šå‘
  - é©—æ”¶: ç«¯é»å·¥ä½œï¼Œé‡å®šå‘æˆåŠŸ

- [ ] **T047** å¯¦ç¾ link_click äº‹ä»¶è¨˜éŒ„
  - åŠŸèƒ½: å¾ä»¤ç‰Œæå–ä¿¡æ¯ï¼Œè¨˜éŒ„é»æ“Šäº‹ä»¶
  - é©—æ”¶: äº‹ä»¶å„²å­˜

- [ ] **T048** å¯¦ç¾é‡å®šå‘é‚è¼¯
  - åŠŸèƒ½: æŸ¥æ‰¾ tracking_linksï¼Œè¿”å› 302 é‡å®šå‘
  - é©—æ”¶: ç”¨æˆ¶é‡å®šå‘åˆ°åŸå§‹ URL

### ç«¯é»å®‰å…¨æ€§èˆ‡æ€§èƒ½

- [ ] **T049** [P] å¯¦ç¾ç«¯é»é€Ÿç‡é™åˆ¶
  - ç­–ç•¥: æ¯å€‹ IP æ¯åˆ†é˜ 1000 æ¬¡è«‹æ±‚
  - é©—æ”¶: éåº¦è«‹æ±‚è¢«æ‹’çµ•

- [ ] **T050** å¯¦ç¾ç«¯é»é©—è­‰éŒ¯èª¤è™•ç†
  - è¡Œç‚º: ç„¡è²å¤±æ•—ï¼ˆç„¡ä¿¡æ¯æ³„éœ²ï¼‰
  - é©—æ”¶: ç„¡æ•ˆè«‹æ±‚è¿”å› 204 æˆ– 302

- [ ] **T051** [P] æ€§èƒ½æ¸¬è©¦
  - æª”æ¡ˆ: `tests/performance/analytics-api-performance.test.ts`
  - ç›®æ¨™: åƒç´ ç«¯é» <100msï¼Œé‡å®šå‘ç«¯é» <200ms
  - é©—æ”¶: æ€§èƒ½æŒ‡æ¨™é”æˆ

- [ ] **T052** é›†æˆ CDN å¿«å–ï¼ˆå¯é¸ï¼‰
  - åŠŸèƒ½: è¿½è¹¤åƒç´ åœ¨é‚Šç•Œç·©å­˜ 60 ç§’
  - é©—æ”¶: æ¸›å°‘æ•¸æ“šåº«æŸ¥è©¢

- [ ] **T053** [P] å®‰å…¨å¯©æŸ¥
  - æª¢æŸ¥: ä»¤ç‰Œé©—è­‰ã€CORSã€é€Ÿç‡é™åˆ¶
  - é©—æ”¶: ç„¡å·²çŸ¥æ¼æ´

- [ ] **T054** å»ºç«‹ `tests/integration/tracking-api.test.ts`
  - æ¸¬è©¦: åƒç´ å’Œé‡å®šå‘ç«¯é»çš„å®Œæ•´æµç¨‹
  - é©—æ”¶: æ‰€æœ‰æ¸¬è©¦é€šé

---

## Phase 5: èšåˆèˆ‡æŸ¥è©¢å„ªåŒ–ï¼ˆ1 é€±ï¼‰

**ç›®çš„**: å„ªåŒ–æŸ¥è©¢æ€§èƒ½ï¼Œå¯¦æ–½æ—¥ snapshot

### Snapshot ç”Ÿæˆ

- [ ] **T055** [P] å»ºç«‹ `src/services/analyticsAggregator.ts`
  - å‡½æ•¸: generateDailySnapshot(), aggregateMetrics()
  - é©—æ”¶: æœå‹™å¯é‹è¡Œ

- [ ] **T056** å¯¦ç¾æ—¥èšåˆ Job
  - åŠŸèƒ½: æ¯å¤©åˆå¤œ UTC é‹è¡Œï¼Œèšåˆå‰ä¸€å¤©çš„äº‹ä»¶
  - é©—æ”¶: Job æˆåŠŸåŸ·è¡Œ

- [ ] **T057** [P] å¯¦ç¾é–‹ä¿¡æ•¸èšåˆ
  - é‚è¼¯: COUNT(DISTINCT user_id) WHERE event_type = 'email_open'
  - é©—æ”¶: èšåˆçµæœå‡†ç¢º

- [ ] **T058** å¯¦ç¾é»æ“Šæ•¸èšåˆ
  - é‚è¼¯: COUNT(DISTINCT user_id) WHERE event_type = 'link_click' BY article
  - é©—æ”¶: çµæœå‡†ç¢º

- [ ] **T059** [P] å¯¦ç¾åœç•™æ™‚é–“èšåˆ
  - é‚è¼¯: AVG(duration_seconds) è¨ˆç®—
  - é©—æ”¶: å¹³å‡å€¼å‡†ç¢º

### æŸ¥è©¢å„ªåŒ–

- [ ] **T060** [P] å»ºç«‹ `src/hooks/useAnalyticsQuery.ts`
  - Hook: useOpenRate(), useClickRate(), useAverageStayTime()
  - é©—æ”¶: Hook å¯åœ¨çµ„ä»¶ä¸­ä½¿ç”¨

- [ ] **T061** å¯¦ç¾ Snapshot æŸ¥è©¢
  - åŠŸèƒ½: å„ªå…ˆæŸ¥è©¢ snapshotï¼Œè‹¥ç„¡æ•¸æ“šå‰‡å›é€€åŸå§‹æ•¸æ“š
  - é©—æ”¶: æŸ¥è©¢é€Ÿåº¦ <2s

- [ ] **T062** [P] å¯¦ç¾å¿«å–ç­–ç•¥
  - ä½¿ç”¨: TanStack Query ç·©å­˜
  - TTL: 5 åˆ†é˜
  - é©—æ”¶: å¾ŒçºŒæŸ¥è©¢è¿”å›ç·©å­˜æ•¸æ“š

- [ ] **T063** å¯¦ç¾æ™‚é–“ç¯„åœç¯©é¸
  - åŠŸèƒ½: æ”¯æ´ week, month, year è¦–åœ–
  - é©—æ”¶: ç¯©é¸å·¥ä½œ

- [ ] **T064** [P] å¯¦ç¾ç­ç´šç¯©é¸
  - åŠŸèƒ½: æŒ‰ class_id ç¯©é¸æ•¸æ“š
  - é©—æ”¶: ç¯©é¸å·¥ä½œ

- [ ] **T065** å»ºç«‹ `tests/unit/services/analyticsAggregator.test.ts`
  - æ¸¬è©¦: èšåˆé‚è¼¯ã€è¨ˆç®—å‡†ç¢ºæ€§
  - é©—æ”¶: æ‰€æœ‰æ¸¬è©¦é€šé

- [ ] **T066** [P] é›†æˆæ¸¬è©¦ï¼šèšåˆæµç¨‹
  - æª”æ¡ˆ: `tests/integration/analytics-aggregation.test.ts`
  - æ¸¬è©¦: å¾äº‹ä»¶åˆ° snapshot çš„å®Œæ•´æµç¨‹
  - é©—æ”¶: æµç¨‹å·¥ä½œ

---

## Phase 6: å„€è¡¨æ¿ UI (MVP)ï¼ˆ1.5 é€±ï¼‰

**ç›®çš„**: å»ºç«‹åŸºç¤å„€è¡¨æ¿å’Œæ ¸å¿ƒè¦–åœ–

### ä¸»å„€è¡¨æ¿é é¢

- [ ] **T067** [P] å»ºç«‹ `src/pages/AnalyticsDashboardPage.tsx`
  - å¸ƒå±€: æ¨™é¡Œã€ç¯©é¸å™¨ã€KPI å¡ç‰‡ã€åœ–è¡¨ã€è¡¨æ ¼
  - é©—æ”¶: é é¢å‘ˆç¾ï¼Œæ”¯æ´éŸ¿æ‡‰å¼è¨­è¨ˆ

- [ ] **T068** å¯¦ç¾é€±é¸æ“‡å™¨
  - åŠŸèƒ½: é¸æ“‡é€±æ¬¡ï¼Œå„€è¡¨æ¿æ•¸æ“šéš¨ä¹‹æ›´æ–°
  - é©—æ”¶: é¸æ“‡å·¥ä½œï¼Œæ•¸æ“šæ›´æ–°

- [ ] **T069** [P] å¯¦ç¾åˆ·æ–°æŒ‰éˆ•
  - åŠŸèƒ½: æ‰‹å‹•åˆ·æ–°æ•¸æ“šï¼ˆç„¡å¿«å–ï¼‰
  - é©—æ”¶: é»æ“Šå¾Œæ•¸æ“šæ›´æ–°

- [ ] **T070** å¯¦ç¾å°å‡ºæŒ‰éˆ•
  - åŠŸèƒ½: å°å‡ºç•¶å‰è¦–åœ–çš„æ•¸æ“š
  - é©—æ”¶: å°å‡ºæŒ‰éˆ•å­˜åœ¨ï¼ˆåŠŸèƒ½åœ¨ Phase 8ï¼‰

### KPI å¡ç‰‡çµ„ä»¶

- [ ] **T071** [P] å»ºç«‹ `src/components/analytics/KPICard.tsx`
  - é¡¯ç¤º: æŒ‡æ¨™åç¨±ã€æ•¸å€¼ã€ç’°æ¯”è®ŠåŒ–ï¼ˆâ†‘/â†“ï¼‰ã€è¶¨å‹¢åœ–
  - é©—æ”¶: çµ„ä»¶å¯é‡ç”¨

- [ ] **T072** å»ºç«‹ `src/components/analytics/OpenRateCard.tsx`
  - æ•¸æ“š: æœ¬é€±é–‹ä¿¡ç‡ (%)ã€å°æ¯”ä¸Šé€±è¶¨å‹¢
  - é©—æ”¶: å¡ç‰‡é¡¯ç¤ºæ­£ç¢ºæ•¸æ“š

- [ ] **T073** [P] å»ºç«‹ `src/components/analytics/ClickRateCard.tsx`
  - æ•¸æ“š: æœ¬é€±é»æ“Šç‡ (%)ã€å°æ¯”ä¸Šé€±è¶¨å‹¢
  - é©—æ”¶: å¡ç‰‡é¡¯ç¤ºæ­£ç¢ºæ•¸æ“š

- [ ] **T074** å»ºç«‹ `src/components/analytics/AvgStayTimeCard.tsx`
  - æ•¸æ“š: å¹³å‡åœç•™æ™‚é–“ï¼ˆåˆ†é˜ï¼‰ã€å°æ¯”ä¸Šé€±è¶¨å‹¢
  - é©—æ”¶: å¡ç‰‡é¡¯ç¤ºæ­£ç¢ºæ•¸æ“š

- [ ] **T075** [P] å»ºç«‹å‹•ç•«å’Œäº’å‹•
  - æ•ˆæœ: æ•¸å€¼å‹•ç•«ã€æ‡¸åœæç¤º
  - é©—æ”¶: å‹•ç•«æµæš¢

### è¶¨å‹¢åœ–çµ„ä»¶

- [ ] **T076** [P] å»ºç«‹ `src/components/analytics/TrendChart.tsx`
  - åœ–è¡¨é¡å‹: æŠ˜ç·šåœ–ï¼ˆä½¿ç”¨ Rechartsï¼‰
  - é©—æ”¶: åœ–è¡¨å‘ˆç¾æ­£ç¢º

- [ ] **T077** å¯¦ç¾ 12 é€±è¶¨å‹¢è¦–åœ–
  - æ•¸æ“š: éå» 12 é€±çš„é–‹ä¿¡ç‡
  - é©—æ”¶: åœ–è¡¨é¡¯ç¤ºå®Œæ•´è¶¨å‹¢

- [ ] **T078** [P] å¯¦ç¾æ™‚é–“ç¯„åœåˆ‡æ›
  - é¸é …: 7 å¤©ã€30 å¤©ã€12 é€±
  - é©—æ”¶: åˆ‡æ›å·¥ä½œ

- [ ] **T079** å¯¦ç¾ç•°å¸¸å€¼æ¨™è¨˜ï¼ˆå¯é¸ï¼‰
  - åŠŸèƒ½: æ¨™è¨˜ç•°å¸¸é«˜æˆ–ä½çš„é»
  - é©—æ”¶: ç•°å¸¸å€¼è¦–è¦ºåŒ–

### æ•¸æ“šè¡¨æ ¼

- [ ] **T080** [P] å»ºç«‹ `src/components/analytics/ClassComparisonTable.tsx`
  - åˆ—: ç­ç´šã€ç™¼é€äººæ•¸ã€é–‹å•Ÿäººæ•¸ã€é–‹ä¿¡ç‡ã€é»æ“Šæ•¸ã€å¹³å‡åœç•™
  - é©—æ”¶: è¡¨æ ¼å‘ˆç¾æ­£ç¢º

- [ ] **T081** å¯¦ç¾ç­ç´šè¡¨æ’åº
  - åŠŸèƒ½: æŒ‰ä»»ä½•åˆ—æ’åº
  - é©—æ”¶: æ’åºå·¥ä½œ

- [ ] **T082** [P] å»ºç«‹ `src/components/analytics/ArticleAnalyticsTable.tsx`
  - åˆ—: æ–‡ç« æ¨™é¡Œã€ç™¼ä½ˆæ—¥æœŸã€é»æ“Šæ•¸ã€é»æ“Šç‡ã€åœç•™æ™‚é–“
  - é©—æ”¶: è¡¨æ ¼å‘ˆç¾æ­£ç¢º

- [ ] **T083** å¯¦ç¾æ–‡ç« è¡¨æ’åºå’Œç¯©é¸
  - åŠŸèƒ½: æ’åºå’ŒæŒ‰æ—¥æœŸç¯©é¸
  - é©—æ”¶: åŠŸèƒ½å·¥ä½œ

- [ ] **T084** [P] å¯¦ç¾åˆ†é 
  - åŠŸèƒ½: æ¯é  20 ç­†ï¼Œæ”¯æ´å‰å¾Œç¿»é 
  - é©—æ”¶: åˆ†é å·¥ä½œ

### å„€è¡¨æ¿é›†æˆ

- [ ] **T085** [P] åœ¨ `src/App.tsx` ä¸­æ·»åŠ è·¯ç”±
  - è·¯ç”±: `/admin/analytics`
  - RLS æª¢æŸ¥: åƒ…é™ç®¡ç†å“¡è¨ªå•
  - é©—æ”¶: è·¯ç”±å·¥ä½œï¼Œæœªæˆæ¬Šç”¨æˆ¶è¢«æ‹’çµ•

- [ ] **T086** å»ºç«‹ `tests/components/analytics/KPICard.test.tsx`
  - é©—æ”¶: çµ„ä»¶æ¸¬è©¦é€šé

- [ ] **T087** [P] å»ºç«‹ `tests/integration/analytics-dashboard.test.ts`
  - é©—æ”¶: å„€è¡¨æ¿é›†æˆæ¸¬è©¦é€šé

---

## Phase 7: é€²éšå„€è¡¨æ¿åŠŸèƒ½ï¼ˆ1 é€±ï¼‰

**ç›®çš„**: å®Œå–„å„€è¡¨æ¿ï¼Œæ·»åŠ é€²éšåˆ†æ

### é€²éšç¯©é¸å’Œå°æ¯”

- [ ] **T088** [P] å¯¦ç¾ç­ç´šç¯©é¸
  - åŠŸèƒ½: é¸æ“‡ç­ç´šï¼Œå„€è¡¨æ¿åªé¡¯ç¤ºè©²ç­ç´šæ•¸æ“š
  - é©—æ”¶: ç¯©é¸å·¥ä½œ

- [ ] **T089** å¯¦ç¾å¤šç­ç´šå°æ¯”
  - åŠŸèƒ½: é¸æ“‡å¤šå€‹ç­ç´šé€²è¡Œå°æ¯”
  - é©—æ”¶: å°æ¯”è¦–åœ–æ­£ç¢º

- [ ] **T090** [P] å¯¦ç¾æ—¥æœŸç¯„åœç¯©é¸
  - åŠŸèƒ½: é¸æ“‡é–‹å§‹å’ŒçµæŸæ—¥æœŸ
  - é©—æ”¶: ç¯©é¸å·¥ä½œ

### é€²éšå¯è¦–åŒ–

- [ ] **T091** [P] å¯¦ç¾ç­ç´šå°æ¯”æ¢å½¢åœ–
  - åœ–è¡¨: ç­ç´šä¸¦æ’å°æ¯”é–‹ä¿¡ç‡å’Œé»æ“Šç‡
  - é©—æ”¶: åœ–è¡¨å‘ˆç¾

- [ ] **T092** å¯¦ç¾æ–‡ç« ç†±åŠ›åœ–ï¼ˆå¯é¸ï¼‰
  - åœ–è¡¨: é¡¯ç¤ºæ–‡ç« ç†±åº¦ï¼ˆé»æ“Šæ•¸ vs åœç•™æ™‚é–“ï¼‰
  - é©—æ”¶: ç†±åŠ›åœ–å‘ˆç¾

### è©³ç´°é é¢

- [ ] **T093** [P] å»ºç«‹ç­ç´šè©³æƒ…é é¢
  - è·¯ç”±: `/admin/analytics/class/:classId`
  - å…§å®¹: è©²ç­ç´šçš„è©³ç´°çµ±è¨ˆå’Œè¶¨å‹¢
  - é©—æ”¶: é é¢å‘ˆç¾

- [ ] **T094** å»ºç«‹æ–‡ç« è©³æƒ…é é¢
  - è·¯ç”±: `/admin/analytics/article/:articleId`
  - å…§å®¹: è©²æ–‡ç« çš„è©³ç´°çµ±è¨ˆå’Œè®€è€…ä¿¡æ¯
  - é©—æ”¶: é é¢å‘ˆç¾

- [ ] **T095** [P] å»ºç«‹é€±è©³æƒ…é é¢
  - è·¯ç”±: `/admin/analytics/week/:weekNumber`
  - å…§å®¹: è©²é€±çš„å®Œæ•´çµ±è¨ˆ
  - é©—æ”¶: é é¢å‘ˆç¾

### æ€§èƒ½å„ªåŒ–

- [ ] **T096** [P] å¯¦æ–½è™›æ“¬æ»¾å‹•
  - åŠŸèƒ½: è¡¨æ ¼æ”¯æ´å¤§æ•¸æ“šé›†ï¼ˆ>1000 è¡Œï¼‰
  - åº«: react-window
  - é©—æ”¶: æ€§èƒ½æŒ‡æ¨™ <2s

- [ ] **T097** å¯¦æ–½åœ–è¡¨æ•¸æ“šæ‡¶åŠ è¼‰
  - åŠŸèƒ½: é–‹å§‹æ™‚åªåŠ è¼‰æœ€è¿‘ 4 é€±ï¼Œç”¨æˆ¶æ»¾å‹•æ™‚åŠ è¼‰æ›´å¤š
  - é©—æ”¶: åˆå§‹åŠ è¼‰ <1s

---

## Phase 8: å°å‡ºèˆ‡å ±è¡¨ï¼ˆ1 é€±ï¼‰

**ç›®çš„**: æ”¯æ´å ±è¡¨å°å‡ºå’Œåˆ†äº«

### CSV å’Œ Excel å°å‡º

- [ ] **T098** [P] å»ºç«‹ `src/components/analytics/ExportButton.tsx`
  - åŠŸèƒ½: ä¸‹æ‹‰èœå–®é¸æ“‡å°å‡ºæ ¼å¼ï¼ˆCSVã€Excelï¼‰
  - é©—æ”¶: æŒ‰éˆ•å¯é»æ“Š

- [ ] **T099** å¯¦ç¾ CSV å°å‡º
  - æ•¸æ“š: å„€è¡¨æ¿ç•¶å‰è¦–åœ–çš„æ•¸æ“š
  - ä½¿ç”¨: papaparse åº«
  - é©—æ”¶: CSV æ–‡ä»¶å¯ä¸‹è¼‰

- [ ] **T100** [P] å¯¦ç¾ Excel å°å‡º
  - åŠŸèƒ½: å¤šå€‹å·¥ä½œè¡¨ï¼ˆåŸå§‹æ•¸æ“šã€åŒ¯ç¸½çµ±è¨ˆã€åœ–è¡¨åœ–ç‰‡ï¼‰
  - ä½¿ç”¨: exceljs åº«
  - é©—æ”¶: Excel æ–‡ä»¶å¯ä¸‹è¼‰

- [ ] **T101** å¯¦ç¾å ±è¡¨æª”åå’Œæ™‚é–“æˆ³
  - æ ¼å¼: `analytics-2025-12-05.csv` æˆ– `.xlsx`
  - é©—æ”¶: æª”åæ­£ç¢º

### å ±è¡¨åˆ†äº«

- [ ] **T102** [P] å¯¦ç¾å ±è¡¨åˆ†äº«é€£çµ
  - åŠŸèƒ½: ç”Ÿæˆå¯åˆ†äº«çš„é€£çµï¼Œä»–äººå¯æŸ¥çœ‹å ±è¡¨
  - éæœŸ: 7 å¤©å¾Œå¤±æ•ˆ
  - é©—æ”¶: åˆ†äº«é€£çµå·¥ä½œ

- [ ] **T103** å»ºç«‹åˆ†äº«é é¢
  - è·¯ç”±: `/analytics/share/:shareToken`
  - é©—æ”¶: é é¢å‘ˆç¾å ±è¡¨

- [ ] **T104** [P] å¯¦ç¾éƒµä»¶åˆ†äº«
  - åŠŸèƒ½: ç›´æ¥éƒµä»¶å ±è¡¨æˆ–åˆ†äº«é€£çµ
  - é©—æ”¶: éƒµä»¶ç™¼é€æˆåŠŸ

---

## Phase 9: æ¸¬è©¦èˆ‡æ–‡æª”ï¼ˆ1 é€±ï¼‰

**ç›®çš„**: å®Œæ•´æ¸¬è©¦å¥—ä»¶å’Œæ–‡æª”

### å–®å…ƒæ¸¬è©¦

- [ ] **T105** [P] å®Œæˆè¿½è¹¤æœå‹™å–®å…ƒæ¸¬è©¦
  - è¦†è“‹: ä»¤ç‰Œæœå‹™ã€åˆ†ææœå‹™
  - ç›®æ¨™: 95%+
  - é©—æ”¶: æ‰€æœ‰æ¸¬è©¦é€šé

- [ ] **T106** å®Œæˆ API ç«¯é»å–®å…ƒæ¸¬è©¦
  - è¦†è“‹: åƒç´ ç«¯é»ã€é‡å®šå‘ç«¯é»
  - é©—æ”¶: æ‰€æœ‰æ¸¬è©¦é€šé

### é›†æˆæ¸¬è©¦

- [ ] **T107** [P] å®Œæˆè¿½è¹¤æµç¨‹é›†æˆæ¸¬è©¦
  - å ´æ™¯: éƒµä»¶é–‹å•Ÿ â†’ é»æ“Š â†’ è¨ªå•ç¶²é  â†’ è¨˜éŒ„äº‹ä»¶
  - é©—æ”¶: å®Œæ•´æµç¨‹å·¥ä½œ

- [ ] **T108** å®Œæˆå„€è¡¨æ¿é›†æˆæ¸¬è©¦
  - å ´æ™¯: ç™»å…¥ â†’ æŸ¥çœ‹å„€è¡¨æ¿ â†’ ç¯©é¸æ•¸æ“š â†’ å°å‡º
  - é©—æ”¶: å®Œæ•´æµç¨‹å·¥ä½œ

### E2E æ¸¬è©¦

- [ ] **T109** [P] å»ºç«‹å®Œæ•´ E2E æ¸¬è©¦
  - å·¥å…·: Playwright
  - å ´æ™¯: ç«¯åˆ°ç«¯éƒµä»¶è¿½è¹¤
  - é©—æ”¶: æ¸¬è©¦é€šé

### æ–‡æª”

- [ ] **T110** [P] å»ºç«‹ API æ–‡æª”
  - æ ¼å¼: OpenAPI 3.0
  - å…§å®¹: è¿½è¹¤ç«¯é»ã€æŸ¥è©¢ç«¯é»ã€å°å‡ºç«¯é»
  - æª”æ¡ˆ: `specs/006-analytics-reporting/docs/API.md`

- [ ] **T111** å»ºç«‹éƒ¨ç½²æŒ‡å—
  - å…§å®¹: æ•¸æ“šåº«é·ç§»ã€å®šæ™‚ä»»å‹™è¨­ç½®ã€ç’°å¢ƒè®Šæ•¸
  - æª”æ¡ˆ: `specs/006-analytics-reporting/docs/DEPLOYMENT.md`

- [ ] **T112** [P] å»ºç«‹æ•¸æ“šéš±ç§å’Œå®‰å…¨æ–‡æª”
  - å…§å®¹: æ•¸æ“šä¿ç•™æ”¿ç­–ã€éš±ç§è€ƒæ…®ã€å®‰å…¨æœ€ä½³å¯¦è¸
  - æª”æ¡ˆ: `specs/006-analytics-reporting/docs/SECURITY.md`

- [ ] **T113** å»ºç«‹æ•…éšœæ’é™¤æŒ‡å—
  - å…§å®¹: å¸¸è¦‹å•é¡Œã€èª¿è©¦æ­¥é©Ÿã€æ—¥èªŒåˆ†æ
  - æª”æ¡ˆ: `specs/006-analytics-reporting/docs/TROUBLESHOOTING.md`

### æœ€çµ‚é©—è­‰

- [ ] **T114** [P] é©—è­‰æ‰€æœ‰åŠŸèƒ½éœ€æ±‚
  - æª¢æŸ¥è¡¨: AC-001 åˆ° AC-010
  - é©—æ”¶: å…¨éƒ¨é€šé

- [ ] **T115** é©—è­‰æ‰€æœ‰æ€§èƒ½éœ€æ±‚
  - æª¢æŸ¥è¡¨: PERF-001 åˆ° PERF-004
  - é©—æ”¶: å…¨éƒ¨é”æˆ

---

## ğŸ“Š ä»»å‹™åˆ†çµ„

### æŒ‰å„ªå…ˆç´š

**P1ï¼ˆé«˜å„ªå…ˆï¼‰**: T001-T015, T016-T027, T028-T041, T042-T054, T055-T066, T067-T084, T105-T115
**P2ï¼ˆä¸¦è¡Œå¯è¡Œï¼‰**: T017-T027, T042-T054, T055-T066, T088-T097, T098-T104

### æŒ‰ç”¨æˆ¶æ•…äº‹

**US1ï¼ˆé–‹ä¿¡ç‡èˆ‡é»æ“Šç‡çµ±è¨ˆï¼‰**: T016-T066, T067-T084
**US2ï¼ˆç­ç´šå°æ¯”åˆ†æï¼‰**: T080-T081, T088-T089
**US3ï¼ˆæ–‡ç« ç¶­åº¦åˆ†æï¼‰**: T082-T084, T093-T094
**US4ï¼ˆæ™‚é–“åºåˆ—åˆ†æï¼‰**: T076-T079, T095
**US5ï¼ˆå ±è¡¨å°å‡ºï¼‰**: T098-T104

---

## âœ… é©—æ”¶æº–å‰‡

æ‰€æœ‰ä»»å‹™å®Œæˆå¾Œï¼š

- [ ] 1705+ æ¸¬è©¦é€šéï¼ˆåŒ…æ‹¬æ–°æ¸¬è©¦ï¼‰
- [ ] ä»£ç¢¼è¦†è“‹ç‡ 95%+
- [ ] æ‰€æœ‰ AC é©—æ”¶æ¨™æº–é€šé
- [ ] æ‰€æœ‰ PERF æ€§èƒ½æ¨™æº–é”æˆ
- [ ] æ‰€æœ‰æ–‡æª”å®Œæˆ
- [ ] åŠŸèƒ½åˆ†æ”¯åˆä½µåˆ° main
- [ ] ç™¼å¸ƒç‰ˆæœ¬æ¨™ç±¤ï¼š`v1.4-analytics-reporting`

---

## ğŸ”— ç›¸é—œè³‡æº

- [spec.md](./spec.md) - åŠŸèƒ½è¦æ ¼æ–‡æª”
- [plan.md](./plan.md) - å¯¦ä½œè¨ˆåŠƒ
- [../docs/analytics/ANALYTICS-STRATEGY.md](../docs/analytics/ANALYTICS-STRATEGY.md) - æŠ€è¡“æˆ°ç•¥
