# Email Newsletter CMS - 未來開發計畫（進度追蹤）

**狀態**: ✅ 規劃完成 | 📋 準備實作
**最後更新**: 2025-12-04

> 📖 **詳細說明與 User Stories**：請參閱 [`FUTURE-PLANS-DETAILS.md`](./FUTURE-PLANS-DETAILS.md)
> 📝 **原始需求**：請參閱 [`requirements.md`](./requirements.md)

---

## 📊 整體進度總覽

### 已完成的基礎功能（3/3 完成）✅
- [x] **001-newsletter-viewer** - 週報閱讀器（Phase 1-4 完成，57%）
- [x] **002-database-structure** - 資料庫架構（44 個任務完成，100%）
- [x] **003-passwordless-auth** - 無密碼認證系統（64 個任務完成，100%）

### SpecKit 規劃進度（0/6 完成）
- [x] 富文本內容編輯器 (P1)
- [ ] 個人化郵件系統 (P1)
- [ ] 第三方郵件平台 API 整合 (P2)
- [ ] 分析與報表 (P2)
- [ ] 模板管理 (P2)
- [ ] 進階權限管理 (P2)

### 實作階段進度（2/7 進行中）
- [x] 階段 0：基礎架構（已完成 - 001, 002, 003）
- [x] 階段 1：驗證 + 基本權限（已完成 - 003-passwordless-auth）
- 🔄 **階段 2：富文本編輯器 + 內容管理增強（進行中 - 004-rich-text-editor）**
  - 已完成：TipTap 編輯器基礎、YouTube 節點、音訊節點、圖片上傳
  - 進行中：媒體庫系統、媒體重用、優化管道
- [ ] 階段 3：管理後台系統（優先順序 1）
  - 管理儀表板、班級與用戶管理
  - 內容管理介面、權限控制 UI
- [ ] 階段 4：分析與報表（優先順序 2）
- [ ] 階段 5：郵件整合 + 個人化（優先順序 3）
- [ ] 階段 6A：媒體管理（優先順序 4）
- [ ] 階段 6B：優化與潤飾（持續進行）

---

## ✅ 1️⃣ 驗證與權限系統 (P1) - 已完成

### SpecKit 工作流
- [x] 已使用 `/speckit.specify` 創建功能規格 → [spec.md](./003-passwordless-auth/spec.md)
- [x] 已使用 `/speckit.plan` 完成技術設計 → [plan.md](./003-passwordless-auth/plan.md)
- [x] 已使用 `/speckit.tasks` 生成實作任務 → [tasks.md](./003-passwordless-auth/tasks.md)

### 核心功能（已實現）
- [x] **Google OAuth 登入** - 無密碼認證（10/10 任務完成）
- [x] **魔法連結認證** - Email OTP 登入（10/10 任務完成）
- [x] **RBAC 角色系統** - 管理員、老師、家長、學生（6/6 任務完成）
- [x] **工作階段管理** - 30天持久化、多裝置支援（9/9 任務完成）
- [x] **安全性與稽核** - 審計日誌、速率限制（9/9 任務完成）
- [x] **RLS 政策** - 資料庫層級權限控制
- [x] **班級訪問控制** - 基於權限的內容過濾
- [x] **家長多孩子關聯** - 查看所有相關班級內容

### 測試覆蓋
- [x] 828 個測試全部通過（100%）
- [x] 單元測試、整合測試、E2E 測試完整
- [x] 效能測試通過

### 技術文檔
- [x] [SETUP.md](./003-passwordless-auth/docs/SETUP.md) - 543 行本地開發指南
- [x] [API-ENDPOINTS.md](./003-passwordless-auth/docs/API-ENDPOINTS.md) - 697 行 API 參考
- [x] [DEPLOYMENT.md](./003-passwordless-auth/docs/DEPLOYMENT.md) - 597 行部署指南
- [x] [SECURITY.md](./003-passwordless-auth/docs/SECURITY.md) - 338 行安全性最佳實踐

**狀態**: ✅ 100% 完成（64/64 任務）| **分支**: `003-passwordless-auth`

---

## 🔄 2️⃣ 富文本內容編輯器 (P1) - 規格完成，實作進行中

### SpecKit 工作流
- [x] 已使用 `/speckit.specify` 創建功能規格 → [spec.md](./004-rich-text-editor/spec.md)
- [x] 已使用 `/speckit.plan` 完成技術設計 → [plan.md](./004-rich-text-editor/plan.md)
- [x] 已使用 `/speckit.tasks` 生成實作任務 → [tasks.md](./004-rich-text-editor/tasks.md)

### 核心功能（已規格化）
- [x] **基本所見即所得文字編輯** (P1) - 粗體、斜體、標題、清單、連結 ✅ 已實作
  - 文字格式：粗體、斜體、底線、刪除線、代碼
  - 標題：H1-H6 + 段落
  - 清單：有序清單、無序清單、工作清單
  - 其他：連結、引用、文字對齐、文字顏色、高亮
  - 進階：上標、下標、任務項目
- [x] **圖片上傳與管理** (P1) - 拖放上傳、自動最佳化、可切換儲存（Supabase/S3） ✅ 已實作
  - 拖放上傳到編輯器
  - 粘貼上傳圖片
  - 自動 WebP 轉換
  - Supabase Storage 集成
  - 儲存 URL 簽名和管理
  - 圖片刪除功能
- [x] **影片嵌入與播放** (P2) - YouTube 內聯播放、回應式設計 ✅ 已實作
  - YouTube URL 檢測和驗證
  - 內聯 iframe 嵌入
  - 回應式 16:9 縱橫比
  - 刪除按鈕和鍵盤快捷鍵
  - 禁用自動粘貼轉換（可選）
  - 支持時間戳參數
- [x] **音訊檔案上傳與播放** (P2) - MP3/WAV 支援、內聯播放器 ✅ 已實作
  - 音訊文件上傳
  - 粘貼上傳支持
  - 內聯音訊播放器
  - 支持 MP3、WAV、OGG、M4A、AAC、FLAC
  - Supabase Storage 集成
  - 播放控制和音量調整
- [x] **HTML 輸出與儲存** (P3) - 編輯器輸出 HTML ✅ 已實作
  - 編輯器輸出：HTML 格式（最佳互操作性）
  - HTML to Markdown 轉換：✅ 已實作（用於匯出）
  - 儲存格式：HTML（數據庫）
  - 備註：放棄雙向 Markdown 轉換，簡化架構

### 📚 媒體庫與資源重用 (P2-P3 新增)
- [ ] **媒體庫系統** - 集中管理所有上傳的圖片、音訊、影片
  - 按日期、類型、標籤組織媒體檔案
  - 搜尋與過濾功能（按檔案名稱、上傳日期、尺寸）
  - 媒體預覽（縮圖、音訊播放器、影片預覽）
  - 批量操作（刪除、標籤、匯出）

- [ ] **媒體重用與共享** - 在多篇文章間重用媒體
  - 參考計數追蹤（某媒體被使用在幾篇文章）
  - 防止刪除正在使用的媒體
  - 媒體使用歷史（查看某媒體在哪些文章中使用）
  - 快速插入最常用媒體的建議

- [ ] **媒體優化與變體** - 為不同用途自動生成媒體變體
  - 自動建立縮圖版本（編輯器瀏覽、郵件預覽）
  - 自動產生 WebP 格式（現代瀏覽器最佳化）
  - 響應式圖片生成（srcset 支援）
  - 音訊轉換（MP3/WAV 互轉，位率最佳化）

- [ ] **媒體使用儀表板** - 可視化媒體管理與使用情況
  - 儲存空間使用統計
  - 媒體類型分佈圖
  - 最常用媒體排名
  - 未使用媒體清單（可安全刪除）
  - 媒體大小與格式最佳化建議

### 規格摘要
- **22 個功能需求**: 涵蓋編輯器介面、媒體上傳、儲存抽象、安全性、自動儲存
- **10 個成功標準**: 可衡量指標（10 分鐘完成文章、5 秒上傳、95% 裝置相容性）
- **5 個使用者故事**: 獨立可測試，優先順序明確
- **8 個邊界情況**: 大檔案、失敗情境、資料管理

### 前置條件
- [x] 資料庫架構完成（002-database-structure）
- [x] 認證系統完成（003-passwordless-auth）
- [x] 基礎編輯器 UI（001-newsletter-viewer 中的 ArticleEditor）

### 預估工作量
- **規劃階段**: 2-3 天（SpecKit 流程）← **下一步**
- **實作階段**: 3-4 週
- **測試與文檔**: 1 週

**狀態**: ✅ 規格完成 | 🔄 實作進行中 | **分支**: `004-rich-text-editor` | **優先級**: P1（高優先）
**進度**: TipTap 編輯器基礎 + 媒體節點完成 → 媒體庫系統進行中

---

## 3️⃣ 管理後台系統 (優先順序 1) - 計劃中

### SpecKit 工作流
- [ ] 已使用 `/speckit.specify` 創建功能規格
- [ ] 已使用 `/speckit.plan` 完成技術設計
- [ ] 已使用 `/speckit.tasks` 生成實作任務

### 核心功能
- [ ] 管理儀表板 - 內容及用戶管理
- [ ] 班級與用戶管理
- [ ] 內容管理介面
- [ ] 權限與存取控制 UI

---

## 4️⃣ 分析與報表 (優先順序 2) - 計劃中

### SpecKit 工作流
- [ ] 已使用 `/speckit.specify` 創建功能規格
- [ ] 已使用 `/speckit.plan` 完成技術設計
- [ ] 已使用 `/speckit.tasks` 生成實作任務

### 核心功能
- [ ] 開信率追蹤（Tracking Pixel）
- [ ] 點擊率追蹤（Redirect URL）
- [ ] 視覺化儀表板（圖表庫整合）
- [ ] 報表匯出（CSV/Excel）
- [ ] 第三方數據同步

---

## 5️⃣ 郵件整合 + 個人化 (優先順序 3) - 計劃中

### SpecKit 工作流
- [ ] 已使用 `/speckit.specify` 創建功能規格
- [ ] 已使用 `/speckit.plan` 完成技術設計
- [ ] 已使用 `/speckit.tasks` 生成實作任務

### 核心功能
- [ ] 班級內容區塊系統
- [ ] 多子女郵件合併邏輯
- [ ] 郵件模板引擎
- [ ] 唯一追蹤 URL 生成
- [ ] Kit Email Platform（ConvertKit）API 整合
- [ ] Webhook 接收（訂閱/退訂事件處理）

---

## 6️⃣ 媒體管理 (優先順序 4) - 計劃中

### SpecKit 工作流
- [ ] 已使用 `/speckit.specify` 創建功能規格
- [ ] 已使用 `/speckit.plan` 完成技術設計
- [ ] 已使用 `/speckit.tasks` 生成實作任務

### 核心功能
- [ ] 媒體庫系統
- [ ] 媒體重用與共享
- [ ] 媒體優化與變體
- [ ] 媒體使用儀表板

---

## 7️⃣ 模板管理 (P2)

### SpecKit 工作流
- [ ] 已使用 `/speckit.specify` 創建功能規格
- [ ] 已使用 `/speckit.plan` 完成技術設計
- [ ] 已使用 `/speckit.tasks` 生成實作任務

### 核心功能
- [ ] 週報模板系統
- [ ] 模板複製工作流
- [ ] 固定內容區域（每週一句善話）
- [ ] 模板版本管理

---

## 📅 實作階段細項追蹤

### ✅ 階段 0：基礎架構（已完成）
- [x] **001-newsletter-viewer** - 週報閱讀器 UI（57% 完成，MVP 可用）
- [x] **002-database-structure** - 完整資料庫架構（44 個任務，100%）
- [x] **003-passwordless-auth** - 無密碼認證系統（64 個任務，100%）

### 🔄 階段 1：富文本編輯器（下一個優先）預估 3-4 週
- [ ] 所見即所得編輯器整合（TipTap/Lexical）
- [ ] 圖片上傳與 Supabase Storage 整合
- [ ] YouTube 影片嵌入功能
- [ ] 音訊檔案上傳與轉換
- [ ] 文章拖拽排序 UI（react-beautiful-dnd）
- [ ] Markdown 與富文本混合編輯

### 階段 1B：媒體庫系統（階段 1 延伸）預估 2-3 週
- [ ] **媒體庫 UI**
  - 媒體瀏覽器網格/清單視圖
  - 搜尋、篩選、排序功能
  - 媒體詳細資訊面板（尺寸、上傳日期、使用次數）
  - 拖放上傳到媒體庫

- [ ] **媒體使用追蹤**
  - 在 `media_usage` 表追蹤每個媒體的引用
  - 文章刪除時自動更新參考計數
  - 防止刪除仍在使用的媒體

- [ ] **媒體重用工作流**
  - 編輯器中插入現有媒體按鈕
  - 媒體庫快速選擇面板
  - 複製文章時保留媒體參考

- [ ] **媒體優化管道**
  - 圖片上傳時自動建立縮圖（50%、75% 寬度）
  - 自動產生 WebP 版本
  - 音訊檔案自動轉換（若需要）
  - 優化後的檔案自動儲存到 Supabase Storage

- [ ] **媒體儀表板**
  - 儲存空間使用率顯示
  - 媒體類型分佈（圓餅圖）
  - 最常用媒體排名
  - 未使用媒體清單與安全刪除選項

### 階段 2：管理後台系統（3-4 週）
- [ ] **管理儀表板** - 內容及用戶管理
  - 週報清單與狀態追蹤（草稿、已發佈、已歸檔）
  - 文章發布日曆視圖
  - 批量發佈/歸檔操作
  - 發布歷史與審計日誌

- [ ] **班級與用戶管理**
  - 班級列表與編輯（新增、編輯、刪除班級）
  - 班級成員管理（家長、學生關聯）
  - 教師指派（班級專屬編輯員）
  - 批量導入用戶（CSV）
  - **支持雙重角色**: 同一用戶可同時為教師（編輯權限）和家長（閱讀權限）
    - 在編輯器中區分上下文（教師模式 vs 家長模式）
    - 家長身份下看到自己孩子的班級
    - 教師身份下看到可編輯的班級
    - 避免角色衝突（教師優先用於內容編輯）

- [ ] **內容管理介面**
  - 文章分類與標籤管理
  - 文章搜尋與篩選
  - 版本歷史與還原功能
  - 內容回收站（已刪除文章恢復）

- [ ] **權限與存取控制 UI**
  - 角色設置管理
  - 個人化班級限制設定
  - 批量權限調整
  - 存取日誌
  - **多角色處理**:
    - 角色優先級：Admin > Teacher > Parent > Student
    - 同一班級內雙重角色的歧義解決
    - 對應操作的權限檢查（取最高權限）

### 階段 3：郵件整合 + 個人化（4-6 週）
- [ ] 郵件服務整合（SendGrid API）
- [ ] Kit Email Platform API 整合（ConvertKit）
- [ ] 用戶自定義欄位同步（班級關聯資料）
- [ ] 個人化內容生成邏輯
- [ ] 多子女郵件合併演算法
- [ ] 追蹤連結生成與管理
- [ ] Webhook 端點建置（訂閱事件監聽）

### 階段 4：分析與報表（3-4 週）
- [ ] 開信率追蹤實作（Tracking Pixel）
- [ ] 點擊率追蹤實作（Redirect URL）
- [ ] 統計儀表板 UI（Chart.js / Recharts）
- [ ] 報表匯出功能（CSV/Excel）
- [ ] 與 ConvertKit 數據同步

### 階段 4：優化與潤飾（持續進行）
- [x] 認證系統效能優化（003 Phase 12 完成）
- [ ] 前端效能優化（Code Splitting、Lazy Loading）
- [ ] 後端查詢優化（索引、快取）
- [ ] UI/UX 改善（響應式設計、無障礙）
- [ ] Bug 修復與使用者回饋整合

---

## 🔗 相關文件

| 文件 | 用途 |
|------|------|
| [`requirements.md`](./requirements.md) | 原始需求記錄與追溯矩陣 |
| [`FUTURE-PLANS-DETAILS.md`](./FUTURE-PLANS-DETAILS.md) | 詳細技術說明、User Stories 與決策記錄 |
| [`001-newsletter-viewer/spec.md`](./001-newsletter-viewer/spec.md) | 已實作的週報閱讀器規格 |
