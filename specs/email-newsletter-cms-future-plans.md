# Email Newsletter CMS System - 完整功能規格書

**建立日期**: 2025-11-15
**狀態**: ✅ 已完成 (Spec Document Created)
**版本**: 1.0

---

## 目錄

1. [系統概述](#系統概述)
2. [User Stories - Email Newsletter 功能](#user-stories---email-newsletter-功能)
3. [User Stories - CMS 功能](#user-stories---cms-功能)
4. [關鍵實體與資料模型](#關鍵實體與資料模型)
5. [系統架構建議](#系統架構建議)
6. [未來開發路線圖](#未來開發路線圖)

---

## 系統概述

Email Newsletter CMS 系統是一個整合的內容管理與電子報發送平台，專為教育機構（幼稚園/學校）設計，用於管理每週電子報內容並發送給家長。系統的核心價值在於：

- **個人化內容呈現**：根據家長孩子所在班級，動態顯示相關的「班級大小事」
- **統一發送體驗**：一個家長無論有幾個孩子，只收到一封郵件，但能看到所有相關班級內容
- **靈活的內容管理**：支援多媒體內容（圖片、影片、錄音）和文章排序管理
- **數據驅動決策**：整合開信率、點擊率等統計數據，優化內容策略

---

## User Stories - Email Newsletter 功能

### US-EMAIL-001: 班級對應的內容區塊

**作為** 系統管理員
**我想要** 為每個班級創建獨立的內容區塊（Block）
**以便** 不同班級的專屬內容能夠被正確管理和分發

**優先級**: P1 (核心功能)

**驗收標準**:
1. **Given** 系統管理員登入後台，**When** 他們進入班級管理介面，**Then** 可以看到所有現有班級列表
2. **Given** 系統管理員想新增班級，**When** 他們填寫班級名稱（如「小熊班」、「小兔班」）並提交，**Then** 系統創建對應的內容區塊
3. **Given** 某個班級存在於系統中，**When** 編輯文章時，**Then** 可以將文章指定給特定班級的區塊
4. **Given** 班級區塊已創建，**When** 家長屬於該班級時，**Then** 他們能在電子報中看到該班級的專屬內容

**技術考量**:
- 班級資料結構應包含：班級 ID、班級名稱、年級、教師列表
- 內容區塊與班級應為一對一關係
- 支援班級的啟用/停用狀態（畢業班級可停用但保留歷史資料）

---

### US-EMAIL-002: 每週複製模板並修改內容

**作為** 內容編輯者（老師/行政人員）
**我想要** 從上週的電子報複製模板，然後修改內容
**以便** 快速創建新一週的電子報，保持格式一致性

**優先級**: P2

**驗收標準**:
1. **Given** 編輯者查看某一週的電子報，**When** 他們點擊「複製為新週報」按鈕，**Then** 系統創建下一週的電子報草稿，保留原有結構和文章分類
2. **Given** 新週報已從模板複製，**When** 編輯者查看內容，**Then** 所有文章標題和內容都可以被編輯
3. **Given** 編輯者修改複製的內容，**When** 他們保存變更，**Then** 不影響原模板週報的內容
4. **Given** 某週報被設為「模板」，**When** 編輯者創建新週報時，**Then** 可以選擇從該模板複製
5. **Given** 編輯者想重複使用固定內容（如「每週一句善話」），**When** 複製模板時，**Then** 這些固定區域自動填入

**技術考量**:
- 實作深拷貝機制，確保內容獨立性
- 支援局部模板（如只複製結構，不複製內容）
- 版本控制友好的資料結構

---

### US-EMAIL-003: 開信率與點擊率統計

**作為** 行銷/管理人員
**我想要** 查看每封電子報的開信率和內文連結的點擊率
**以便** 了解家長的閱讀習慣，優化內容策略

**優先級**: P2

**驗收標準**:
1. **Given** 某週電子報已發送，**When** 管理者進入統計頁面，**Then** 可以看到該週的總發送數、開信數、開信率
2. **Given** 電子報中包含外部連結，**When** 家長點擊連結，**Then** 系統記錄點擊事件並歸類到對應文章
3. **Given** 管理者查看某篇文章的數據，**When** 他們查看詳細報表，**Then** 可以看到該文章連結的點擊次數和獨立點擊用戶數
4. **Given** 統計數據已收集，**When** 管理者導出報表，**Then** 可以選擇 CSV 或 Excel 格式下載
5. **Given** 不同班級的開信率不同，**When** 管理者查看分班統計，**Then** 可以看到各班級的數據對比

**技術考量**:
- 使用追蹤像素 (tracking pixel) 記錄開信
- 使用重定向連結 (redirect URL) 追蹤點擊
- 整合 Google Analytics 或專用電子報服務（如 SendGrid, Mailchimp）
- 遵守隱私法規 (GDPR, CCPA)，提供退出追蹤選項

---

### US-EMAIL-004: 家長多子女合併電子報

**作為** 有多個孩子在不同班級的家長
**我想要** 只收到一封電子報，但能看到所有孩子班級的內容
**以便** 減少郵件混亂，一次性了解所有孩子的學校動態

**優先級**: P1 (核心功能)

**驗收標準**:
1. **Given** 家長 A 有兩個孩子分別在「小熊班」和「小兔班」，**When** 系統發送週報時，**Then** 家長 A 只收到一封郵件
2. **Given** 合併後的郵件已發送，**When** 家長點開郵件中的連結，**Then** 網頁同時顯示「小熊班」和「小兔班」的「班級大小事」文章
3. **Given** 家長登入 CMS 網站，**When** 系統識別其身份（通過郵件連結或登入），**Then** 自動顯示所有相關班級的內容
4. **Given** 家長只有一個孩子在單一班級，**When** 收到郵件，**Then** 只看到該班級的內容（不顯示其他班級）
5. **Given** 家長資料更新（新增/移除孩子），**When** 下次發送郵件時，**Then** 系統自動調整顯示的班級內容

**技術考量**:
- 資料庫設計：家長與學生多對多關係，學生與班級多對一關係
- 郵件生成邏輯：根據家長關聯的班級動態組合內容
- 個人化連結：每封郵件包含唯一的 token 用於識別家長身份
- 性能優化：批量處理家長-班級關聯查詢

---

### US-EMAIL-005: 統一外觀的個人化郵件

**作為** 家長
**我想要** 收到的電子報看起來都一樣（統一品牌形象）
**以便** 獲得專業、一致的閱讀體驗，但打開後能看到我孩子班級的專屬內容

**優先級**: P2

**驗收標準**:
1. **Given** 所有家長都收到週報，**When** 他們查看郵件外觀，**Then** 郵件的標題、版式、顏色、Logo 完全相同
2. **Given** 家長點開郵件中的「查看完整內容」連結，**When** 頁面加載，**Then** CMS 根據 URL 中的身份 token 顯示該家長孩子的班級內容
3. **Given** 郵件內容包含通用區域（如校長的話、全校活動）和班級專屬區域，**When** 家長查看，**Then** 通用區域對所有人相同，班級區域根據身份動態顯示
4. **Given** 家長分享郵件連結給其他家長，**When** 其他家長點開，**Then** 看到的是自己孩子的班級內容（需登入或通過個人化連結）
5. **Given** CMS 判斷身份失敗（如未登入、token 過期），**When** 家長訪問，**Then** 顯示登入頁面或默認的公開內容

**技術考量**:
- 郵件模板設計：使用響應式 HTML 模板，確保跨郵件客戶端一致性
- 身份識別機制：
  - 選項 1：URL 參數包含加密 token（`?token=xyz123`）
  - 選項 2：整合 SSO（Single Sign-On）
  - 選項 3：Magic link（無密碼登入）
- 內容渲染邏輯：服務端根據身份組合通用內容 + 班級專屬內容
- 快取策略：通用內容可快取，個人化內容需即時生成

---

## User Stories - CMS 功能

### US-CMS-001: 按週顯示多篇文章（含善話）

**作為** 讀者（家長或老師）
**我想要** 查看某一週的所有文章，包括該週的「每週一句善話」
**以便** 了解該週的完整內容和靈性啟發

**優先級**: P1 (核心功能)

**驗收標準**:
1. **Given** 讀者訪問 CMS 首頁，**When** 選擇特定週份（如 2025-W46），**Then** 系統顯示該週的文章列表和「每週一句善話」
2. **Given** 該週包含 5 篇文章，**When** 讀者查看列表，**Then** 可以看到所有文章標題按設定順序排列
3. **Given** 讀者點擊某篇文章，**When** 文章打開，**Then** 該週的「每週一句善話」顯示在頁面頂部或側邊欄
4. **Given** 某週尚未設定「善話」，**When** 讀者查看該週，**Then** 顯示默認佔位內容或隱藏該區域
5. **Given** 編輯者更新「善話」內容，**When** 讀者刷新頁面，**Then** 立即看到最新的「善話」

**技術考量**:
- 資料結構：週份實體應包含 `weeklyQuote` 欄位
- UI 設計：善話可設計為卡片式組件，位於文章列表上方
- Markdown 支援：善話內容支援簡單的 Markdown 格式（如斜體、粗體）

---

### US-CMS-002: 新增週報文章

**作為** 內容編輯者
**我想要** 為某一週新增文章
**以便** 持續更新週報內容

**優先級**: P1 (核心功能)

**驗收標準**:
1. **Given** 編輯者登入 CMS，**When** 進入某週的編輯介面，**Then** 看到「新增文章」按鈕
2. **Given** 編輯者點擊「新增文章」，**When** 編輯器打開，**Then** 可以填寫文章標題、內容、選擇班級分類
3. **Given** 編輯者完成內容編寫，**When** 點擊「儲存」，**Then** 文章儲存並出現在該週的文章列表中
4. **Given** 編輯者想新增多篇文章，**When** 重複新增操作，**Then** 所有文章都被正確儲存並按新增順序排列（或可自訂順序）
5. **Given** 編輯者未填寫必填欄位（如標題），**When** 嘗試儲存，**Then** 系統顯示錯誤提示

**技術考量**:
- 所見即所得編輯器（WYSIWYG）或 Markdown 編輯器
- 自動儲存草稿功能（避免資料丟失）
- 文章狀態管理：草稿、已發布、已排程

---

### US-CMS-003: 設定文章順序

**作為** 內容編輯者
**我想要** 自由調整某週內文章的顯示順序
**以便** 控制讀者的閱讀流程，優先呈現重要內容

**優先級**: P2

**驗收標準**:
1. **Given** 某週有 5 篇文章，**When** 編輯者進入順序編輯模式，**Then** 可以拖拽文章卡片重新排列
2. **Given** 編輯者調整順序後，**When** 點擊「儲存順序」，**Then** 讀者端立即反映新的順序
3. **Given** 編輯者想將第 5 篇文章移到第 1 位，**When** 拖拽到頂部，**Then** 其他文章自動向下調整位置
4. **Given** 某篇文章正在編輯中，**When** 其他編輯者調整順序，**Then** 不影響正在編輯的文章內容
5. **Given** 文章順序已儲存，**When** 系統生成電子報郵件，**Then** 郵件中的文章連結按新順序排列

**技術考量**:
- 使用拖拽庫（如 React DnD, SortableJS）
- 資料庫欄位：`order` 或 `position` 儲存排序值
- 批量更新優化：一次操作更新多篇文章的順序值

---

### US-CMS-004: 班級權限控制文章可見性

**作為** 系統管理員
**我想要** 設定某篇文章只能被特定班級的家長看到
**以便** 保護班級隱私，確保家長只看到自己孩子班級的「班級大小事」

**優先級**: P1 (核心功能)

**驗收標準**:
1. **Given** 編輯者創建文章時，**When** 選擇文章類型為「班級大小事」，**Then** 系統要求選擇對應的班級
2. **Given** 文章已設定為「小熊班」專屬，**When** 小兔班的家長登入查看，**Then** 該文章不顯示在他們的列表中
3. **Given** 文章設定為「全校公開」，**When** 任何家長查看，**Then** 該文章對所有人可見
4. **Given** 家長有兩個孩子分別在小熊班和小兔班，**When** 他們登入，**Then** 同時看到兩個班級的「班級大小事」
5. **Given** 老師屬於某班級，**When** 他們登入編輯模式，**Then** 預設只看到自己班級的文章（可選：管理員能看到所有文章）

**技術考量**:
- 權限模型設計：
  - 文章表新增 `visibility` 欄位（`public`, `class_specific`）
  - 文章與班級多對多關係表（`article_classes`）
- 查詢優化：使用索引加速權限過濾查詢
- 快取策略：根據用戶班級關聯快取文章列表

---

### US-CMS-005: 每篇文章的獨立 URL

**作為** 內容編輯者或行銷人員
**我想要** 每篇文章都有唯一的、可分享的 URL
**以便** 在電子報郵件、社群媒體中直接連結到特定文章

**優先級**: P1 (核心功能)

**驗收標準**:
1. **Given** 某篇文章已發布，**When** 系統生成該文章，**Then** 自動創建唯一 URL（如 `/newsletter/2025-w46/article/123`）
2. **Given** 編輯者複製文章 URL，**When** 貼上在瀏覽器，**Then** 直接打開該文章的完整內容
3. **Given** 文章 URL 包含在郵件中，**When** 家長點擊，**Then** 網頁打開並顯示該文章及週報導航
4. **Given** 文章被刪除或設為草稿，**When** 訪問其 URL，**Then** 顯示 404 錯誤或「文章不可用」提示
5. **Given** 文章標題修改，**When** 訪問原 URL，**Then** 仍然能正確打開（URL 基於 ID 而非標題）

**技術考量**:
- URL 結構設計：`/newsletter/{week_id}/article/{article_id}`
- SEO 友好：可選擇 slug 格式（如 `/newsletter/2025-w46/good-words-of-week`）
- 不可變 URL：文章 ID 一旦生成不可更改，確保連結永久有效
- 重定向處理：如文章移動週份，設定 301 重定向

---

### US-CMS-006: 週報系列的統一 URL

**作為** 讀者
**我想要** 通過一個 URL 訪問某週的所有文章
**以便** 快速瀏覽該週的完整內容，而不用逐篇尋找

**優先級**: P1 (核心功能)

**驗收標準**:
1. **Given** 某週有多篇文章，**When** 系統生成該週報，**Then** 創建週報統一 URL（如 `/newsletter/2025-w46`）
2. **Given** 讀者訪問週報 URL，**When** 頁面加載，**Then** 顯示該週所有文章的列表和第一篇文章的內容
3. **Given** 週報 URL 分享給其他人，**When** 他們點開，**Then** 能看到相同的週報結構（但班級專屬內容根據身份動態顯示）
4. **Given** 週報包含 10 篇文章，**When** 讀者查看週報頁面，**Then** 可以通過側邊欄或導航快速跳轉到任何一篇
5. **Given** 某週報尚未發布任何文章，**When** 訪問該週 URL，**Then** 顯示「本週內容即將發布」或空狀態提示

**技術考量**:
- 路由設計：週報 URL 映射到週報詳情頁組件
- 內容聚合：一次查詢該週所有文章（含權限過濾）
- 麵包屑導航：首頁 > 2025 年 > 第 46 週

---

### US-CMS-007: 多子女家長合併查看班級大小事

**作為** 有兩個孩子在不同班級的家長
**我想要** 在同一個頁面同時看到兩個班級的「班級大小事」
**以便** 無需切換頁面，一次性了解所有孩子的班級動態

**優先級**: P1 (核心功能)

**驗收標準**:
1. **Given** 家長 A 有孩子在小熊班和小兔班，**When** 他們登入查看某週的週報，**Then** 頁面同時顯示「小熊班大小事」和「小兔班大小事」文章
2. **Given** 某週小熊班有 2 篇班級文章，小兔班有 3 篇，**When** 家長查看，**Then** 所有 5 篇班級文章都顯示（可按班級分組或標記）
3. **Given** 家長只有一個孩子在單一班級，**When** 查看週報，**Then** 只顯示該班級的文章（不顯示其他班級內容）
4. **Given** 班級文章與全校公開文章混合，**When** 頁面渲染，**Then** 可清楚區分哪些是班級專屬、哪些是全校內容（通過標籤或分組）
5. **Given** 家長的孩子資訊更新（轉班/畢業），**When** 下次登入，**Then** 自動調整顯示的班級內容

**技術考量**:
- UI 設計選項：
  - 選項 1：文章列表中以徽章標記班級（如「小熊班」標籤）
  - 選項 2：分組顯示（「小熊班大小事」區塊 + 「小兔班大小事」區塊）
- 查詢邏輯：`WHERE class_id IN (user_children_classes) OR visibility = 'public'`
- 性能優化：快取用戶的班級關聯列表

---

### US-CMS-008: 文章導航快速切換

**作為** 讀者
**我想要** 在同週的文章之間快速切換（上一篇/下一篇）
**以便** 流暢地閱讀完整週報，不需返回列表頁

**優先級**: P2

**驗收標準**:
1. **Given** 讀者正在查看某週的第 3 篇文章，**When** 點擊「下一篇」按鈕，**Then** 立即顯示第 4 篇文章
2. **Given** 讀者正在查看第 1 篇文章，**When** 點擊「上一篇」，**Then** 按鈕禁用或顯示「已是第一篇」提示
3. **Given** 讀者正在查看最後一篇文章，**When** 點擊「下一篇」，**Then** 按鈕禁用或顯示「已是最後一篇」提示
4. **Given** 讀者使用鍵盤操作，**When** 按下左/右方向鍵，**Then** 切換到上一篇/下一篇文章
5. **Given** 讀者在手機上查看，**When** 左右滑動螢幕，**Then** 切換文章（可選功能）

**技術考量**:
- 導航邏輯：根據文章順序值計算上一篇/下一篇的 ID
- 預載入優化：預先加載相鄰文章的內容，提升切換速度
- 無限滾動 vs. 分頁：根據文章數量選擇合適方案

---

### US-CMS-009: 文章支援圖片與文字

**作為** 內容編輯者
**我想要** 在文章中插入圖片和格式化文字
**以便** 創作豐富、視覺吸引力強的內容

**優先級**: P1 (核心功能)

**驗收標準**:
1. **Given** 編輯者撰寫文章，**When** 點擊「插入圖片」按鈕，**Then** 可以上傳本地圖片或輸入圖片 URL
2. **Given** 圖片已插入，**When** 文章儲存並發布，**Then** 讀者能正常查看圖片（支援響應式縮放）
3. **Given** 編輯者輸入文字，**When** 使用工具列格式化（粗體、斜體、標題、列表），**Then** 文字正確渲染格式
4. **Given** 文章包含大尺寸圖片，**When** 系統處理上傳，**Then** 自動壓縮並生成多種尺寸（原圖、縮圖）
5. **Given** 圖片檔案損壞或不可用，**When** 讀者查看文章，**Then** 顯示預設佔位圖或錯誤提示

**技術考量**:
- 編輯器選擇：TipTap, Quill, 或 Markdown 編輯器
- 圖片儲存：雲端儲存（AWS S3, Cloudinary）或本地伺服器
- 圖片優化：自動壓縮、WebP 格式轉換、Lazy loading
- 安全性：檔案類型驗證、檔案大小限制（如 5MB）

---

### US-CMS-010: 支援多媒體內容（錄音、YouTube 影片）

**作為** 內容編輯者
**我想要** 在文章中嵌入錄音和 YouTube 影片
**以便** 提供多樣化的學習內容（如老師朗讀故事、課堂活動影片）

**優先級**: P2

**驗收標準**:
1. **Given** 編輯者撰寫文章，**When** 點擊「插入影片」並輸入 YouTube URL，**Then** 系統自動嵌入播放器
2. **Given** YouTube 影片已嵌入，**When** 讀者查看文章，**Then** 可以直接在頁面內播放影片（無需跳轉）
3. **Given** 編輯者想加入錄音，**When** 上傳音訊檔案（MP3, WAV），**Then** 系統嵌入音訊播放器
4. **Given** 錄音檔案較大，**When** 系統處理上傳，**Then** 自動轉換為網路優化格式（如 MP3 128kbps）
5. **Given** 文章包含 YouTube 影片，**When** 在電子報郵件中顯示，**Then** 顯示影片縮圖和「點擊觀看」連結（郵件不支援嵌入播放器）

**技術考量**:
- YouTube 嵌入：使用 iframe 或 YouTube IFrame API
- 音訊處理：FFmpeg 轉換格式、音訊播放器組件（HTML5 `<audio>`）
- 儲存策略：影片連結儲存 URL，音訊檔案上傳到雲端
- 隱私考量：YouTube 使用 `youtube-nocookie.com` 域名提升隱私

---

### US-CMS-011: 老師編輯文章內容

**作為** 老師
**我想要** 編輯我所負責班級的文章內容
**以便** 及時更新班級動態，無需依賴行政人員

**優先級**: P2

**驗收標準**:
1. **Given** 老師 A 負責小熊班，**When** 他們登入 CMS，**Then** 只能看到並編輯小熊班的文章（不能編輯其他班級）
2. **Given** 老師想修改某篇已發布文章，**When** 點擊「編輯」並修改內容後儲存，**Then** 變更立即生效（或進入待審核狀態，視權限設定）
3. **Given** 老師沒有管理員權限，**When** 他們嘗試刪除文章，**Then** 系統拒絕操作並提示權限不足
4. **Given** 管理員啟用「編輯審核」功能，**When** 老師提交編輯，**Then** 變更進入待審核隊列，需管理員批准後才發布
5. **Given** 老師同時負責兩個班級，**When** 登入編輯模式，**Then** 可以切換班級視圖並編輯對應內容

**技術考量**:
- 角色權限設計：
  - 管理員：所有權限
  - 老師：僅能編輯所屬班級的文章
  - 只讀用戶：僅查看權限
- 審核工作流：草稿 → 待審核 → 已發布
- 編輯鎖定：防止多人同時編輯同一篇文章（可選）

---

### US-CMS-012: 整合統計數據

**作為** 內容編輯者或管理員
**我想要** 在 CMS 內直接查看文章的閱讀數據（開信率、點擊率）
**以便** 快速評估內容效果，優化未來的文章策略

**優先級**: P3

**驗收標準**:
1. **Given** 某篇文章已發布並發送郵件，**When** 編輯者查看該文章，**Then** 可以看到開信數、點擊數、閱讀完成率
2. **Given** 管理員進入統計儀表板，**When** 選擇某週，**Then** 可以看到該週所有文章的數據對比（表格或圖表）
3. **Given** 某文章的點擊率特別高，**When** 管理員查看數據，**Then** 可以深入分析哪些連結被點擊最多
4. **Given** 編輯者想匯出數據，**When** 點擊「匯出報表」，**Then** 下載包含所有週報統計的 CSV 檔案
5. **Given** 統計數據來自第三方服務（如 Mailchimp），**When** CMS 同步數據，**Then** 每小時自動更新一次

**技術考量**:
- 數據來源整合：
  - 郵件服務商 API（SendGrid, Mailchimp, AWS SES）
  - Google Analytics API（網頁閱讀數據）
- 儀表板設計：使用圖表庫（Chart.js, Recharts）
- 數據同步策略：Webhook 即時更新 或 定時批量同步
- 隱私合規：匿名化個人數據，僅顯示聚合統計

---

## 關鍵實體與資料模型

### 1. User（用戶）
```typescript
interface User {
  id: string
  email: string
  name: string
  role: 'admin' | 'teacher' | 'parent'
  children?: Child[]  // 家長關聯的孩子
  managedClasses?: Class[]  // 老師負責的班級
}
```

### 2. Child（學生）
```typescript
interface Child {
  id: string
  name: string
  classId: string
  parentIds: string[]  // 多位家長（父母）
}
```

### 3. Class（班級）
```typescript
interface Class {
  id: string
  name: string  // 如「小熊班」
  grade: string  // 如「大班」
  teachers: string[]  // 教師 ID 列表
  isActive: boolean
}
```

### 4. Newsletter（週報）
```typescript
interface Newsletter {
  id: string
  weekId: string  // 如 '2025-W46'
  publishDate: Date
  weeklyQuote: string  // 每週一句善話
  articles: Article[]
  status: 'draft' | 'published'
}
```

### 5. Article（文章）
```typescript
interface Article {
  id: string
  newsletterId: string
  title: string
  content: string  // HTML 或 Markdown
  order: number  // 排序序號
  visibility: 'public' | 'class_specific'
  classIds: string[]  // 可見的班級 ID（如設為 class_specific）
  author: string  // 作者 ID
  createdAt: Date
  updatedAt: Date
  mediaAttachments?: MediaAttachment[]
}
```

### 6. MediaAttachment（多媒體附件）
```typescript
interface MediaAttachment {
  id: string
  type: 'image' | 'audio' | 'video'
  url: string
  thumbnailUrl?: string
  fileSize: number
  metadata?: {
    duration?: number  // 音訊/影片長度（秒）
    dimensions?: { width: number; height: number }  // 圖片尺寸
  }
}
```

### 7. EmailCampaign（郵件發送記錄）
```typescript
interface EmailCampaign {
  id: string
  newsletterId: string
  sentAt: Date
  totalRecipients: number
  deliveredCount: number
  openedCount: number
  clickedCount: number
  bouncedCount: number
  recipientGroups: {
    classId: string
    recipientCount: number
  }[]
}
```

### 8. Analytics（統計數據）
```typescript
interface Analytics {
  articleId: string
  views: number
  uniqueVisitors: number
  clicks: number  // 文章內連結點擊次數
  avgReadTime: number  // 平均閱讀時間（秒）
  clicksByLink: {
    url: string
    clicks: number
  }[]
}
```

---

## 系統架構建議

### 前端技術棧
- **框架**: React + TypeScript（當前已使用）
- **路由**: React Router
- **狀態管理**: Zustand 或 Context API
- **編輯器**: TipTap（所見即所得）或 React-Markdown（Markdown）
- **UI 組件**: Tailwind CSS + Headless UI（當前已使用）
- **拖拽**: @dnd-kit/core（文章排序）

### 後端技術棧
- **選項 1（無伺服器）**:
  - Firebase (Firestore + Authentication + Storage)
  - Cloud Functions 處理郵件發送邏輯

- **選項 2（傳統後端）**:
  - Node.js + Express
  - PostgreSQL（關聯式資料庫）
  - Prisma（ORM）
  - AWS S3（媒體儲存）

### 郵件服務
- **推薦**: SendGrid 或 Mailchimp
  - 原因：內建追蹤、模板管理、高送達率
  - 替代方案：AWS SES（成本更低但需自建追蹤）

### 身份驗證
- **選項 1**: Firebase Authentication（快速整合）
- **選項 2**: Auth0 或 Supabase Auth
- **選項 3**: Magic Link（無密碼登入，適合家長）

---

## 未來開發路線圖

### 第一階段（MVP - 最小可行產品）
**預計時程**: 6-8 週

✅ **已完成**:
- US-CMS-001: 按週顯示文章
- US-CMS-005: 文章獨立 URL
- US-CMS-006: 週報統一 URL
- US-CMS-008: 文章導航切換

🔲 **待開發**:
- US-EMAIL-001: 班級區塊系統
- US-CMS-002: 新增文章功能
- US-CMS-003: 文章排序
- US-CMS-004: 班級權限控制
- US-CMS-009: 圖文編輯器

### 第二階段（郵件整合）
**預計時程**: 4-6 週

🔲 **待開發**:
- US-EMAIL-002: 模板複製功能
- US-EMAIL-004: 多子女合併郵件
- US-EMAIL-005: 個人化郵件生成
- US-CMS-007: 多班級合併顯示
- 郵件模板設計與測試

### 第三階段（多媒體與進階編輯）
**預計時程**: 3-4 週

🔲 **待開發**:
- US-CMS-010: 多媒體支援（影片、音訊）
- US-CMS-011: 老師編輯權限
- 圖片優化與 CDN 整合
- 行動裝置響應式優化

### 第四階段（數據分析）
**預計時程**: 3-4 週

🔲 **待開發**:
- US-EMAIL-003: 開信率與點擊率追蹤
- US-CMS-012: 統計數據整合
- 分析儀表板
- 報表匯出功能

### 第五階段（優化與擴展）
**預計時程**: 持續迭代

🔲 **待開發**:
- 多語言支援（中文/英文）
- 郵件 A/B 測試
- 推播通知（Web Push）
- 行動 App（React Native）
- AI 輔助內容生成（如自動摘要）

---

## 附錄：技術決策記錄

### TDR-001: 為何選擇 Markdown 而非 WYSIWYG？
**決策**: 使用所見即所得編輯器（TipTap）
**原因**:
- 老師可能不熟悉 Markdown 語法
- 圖片、影片嵌入在 WYSIWYG 中更直觀
- 可保留 Markdown 作為備選方案（支援匯入/匯出）

### TDR-002: 單一資料庫 vs. 微服務架構？
**決策**: 單一資料庫（Monolithic）
**原因**:
- 專案規模初期較小，微服務過度設計
- 減少開發複雜度和維護成本
- 可在未來需要時重構為微服務

### TDR-003: 郵件內嵌內容 vs. 連結到網頁？
**決策**: 郵件內包含摘要 + 連結到完整網頁
**原因**:
- 郵件客戶端對 HTML 支援不一，複雜排版容易出錯
- 網頁可提供更好的閱讀體驗（導航、多媒體）
- 追蹤點擊率需要連結跳轉

---

**文件狀態**: ✅ 已完成
**最後更新**: 2025-11-15
**負責人**: AI Assistant
**審核者**: 待指定

---

**變更記錄**:
- 2025-11-15: 創建初始版本，包含 5 個 Email Newsletter User Stories 和 12 個 CMS User Stories
